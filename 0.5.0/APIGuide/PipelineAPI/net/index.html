<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Net - Analytics Zoo</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-125166209-1', 'analytics-zoo.github.io');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Analytics Zoo</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Overview</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Releases <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../release-download/">Download</a>
</li>
                                    
<li >
    <a href="../../../release-docs/">Documentation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Python</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../PythonUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/examples/">Examples</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/python-faq/">FAQ</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Scala</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ScalaUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../../ScalaUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../../ScalaUserGuide/examples/">Examples</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programming Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/nnframes/">DataFrame and ML Pipeline</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/autograd/">Autograd</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/transferlearning/">Transfer Learning</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/inference/">Model Serving</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/tensorflow/">TFPark</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-models/">Text Models</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/workingwithimages/">Working with Images</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/workingwithtexts/">Working with Texts</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Built-in Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/object-detection/">Object Detection API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/image-classification/">Image Classification API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-classification/">Text Classification API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/recommendation/">Recommendation API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/anomaly-detection/">Anomaly Detection API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-matching/">Text Matching API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/seq2seq/">Sequence to Sequence API</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../ProgrammingGuide/usercases-overview/">Reference Use Cases</a>
</li>
                                    
<li >
    <a href="../../../ProgrammingGuide/run-on-dataproc/">Run on Google Cloud Dataproc</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">White Paper <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../wp-bigdl/">BigDL</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../nnframes/">NNFrames</a>
</li>
            
<li >
    <a href="../math/">Autograd-Math</a>
</li>
            
<li >
    <a href="../variable/">Autograd-Variable</a>
</li>
            
<li class="active">
    <a href="./">Net</a>
</li>
            
<li >
    <a href="../inference/">Inference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../TFPark/model/">KerasModel</a>
</li>
            
<li >
    <a href="../../TFPark/estimator/">TFEstimator</a>
</li>
            
<li >
    <a href="../../TFPark/text-models/">Text Models</a>
</li>
            
<li >
    <a href="../../TFPark/bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../FeatureEngineering/featureset/">FeatureSet</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/relation/">Relation</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/image/">Image</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/text/">Text</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../Models/object-detection/">Object Detection</a>
</li>
            
<li >
    <a href="../../Models/image-classification/">Image Classification</a>
</li>
            
<li >
    <a href="../../Models/text-classification/">Text Classification</a>
</li>
            
<li >
    <a href="../../Models/recommendation/">Recommendation</a>
</li>
            
<li >
    <a href="../../Models/anomaly-detection/">Anomaly Detection</a>
</li>
            
<li >
    <a href="../../Models/text-matching/">Text Matching</a>
</li>
            
<li >
    <a href="../../Models/seq2seq/">Sequence to Sequence</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Keras-Style API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../KerasStyleAPIGuide/keras-api-python/">Python Guide</a>
</li>
                                    
<li >
    <a href="../../../KerasStyleAPIGuide/keras-api-scala/">Scala Guide</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Layers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/activation/">Activation</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/initialization/">Initialization</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/core/">Core Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/convolutional/">Convolutional Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/pooling/">Pooling Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/recurrent/">Recurrent Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/normalization/">Normalization Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/embedding/">Embedding Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/dropout/">Dropout Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/advanced-activation/">Advanced Activations</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/wrappers/">Layer Wrappers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Optimization</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/training/">Train, evaluate or predict a model</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/optimizers/">Optimizers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/objectives/">Objectives</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../powered-by/">Powered by</a>
                            </li>
                            <li >
                                <a href="../../../presentations/">Presentations</a>
                            </li>
                            <li >
                                <a href="../../../known-issues/">FAQ and Known Issues</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../variable/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../inference/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/intel-analytics/analytics-zoo/edit/master/docs/APIGuide/PipelineAPI/net.md">Edit on Fork on GitHub </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#net">Net</a></li>
            <li><a href="#load-analytics-zoo-model">Load Analytics Zoo Model</a></li>
            <li><a href="#load-bigdl-model">Load BigDL Model</a></li>
            <li><a href="#load-torch-model">Load Torch Model</a></li>
            <li><a href="#load-caffe-model">Load Caffe Model</a></li>
            <li><a href="#load-tensorflow-model">Load TensorFlow model</a></li>
        <li class="main "><a href="#tfnet">TFNet</a></li>
            <li><a href="#export-tensorflow-model-to-frozen-inference-graph">Export TensorFlow model to frozen inference graph</a></li>
            <li><a href="#creating-a-tfnet">Creating a TFNet</a></li>
        <li class="main "><a href="#tfdataset">TFDataset</a></li>
            <li><a href="#methods">Methods</a></li>
        <li class="main "><a href="#tfoptimizer">TFOptimizer</a></li>
        <li class="main "><a href="#tfpredictor">TFPredictor</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="net">Net</h2>
<h3 id="load-analytics-zoo-model">Load Analytics Zoo Model</h3>
<p>Use <code>Net.load</code>(in Scala) or <code>Net.load</code> (in Python) to load an existing model defined using the Analytics Zoo Keras-style API.  <code>Net</code> (Scala) or <code>Net</code>(Python) is a utility class provided in Analytics Zoo. We just need to specify the model path and optionally weight path if exists where we previously saved the model to load it to memory for resume training or prediction purpose.</p>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.load(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
val model = Net.load(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.load(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.load(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
model = Net.load(&quot;hdfs://...&quot;) //load from hdfs
model = Net.load(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-bigdl-model">Load BigDL Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadBigDL(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
val model = Net.loadBigDL(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.loadBigDL(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadBigDL(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
model = Net.loadBigDL(&quot;hdfs://...&quot;) //load from hdfs
model = Net.loadBigDL(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-torch-model">Load Torch Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadTorch(&quot;/tmp/torch_model&quot;) //load from local fs
val model = Net.loadTorch(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.loadTorch(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadTorch(&quot;/tmp/torch_model&quot;) //load from local fs
model = Net.loadTorch(&quot;hdfs://...&quot;) //load from hdfs
model = Net.loadTorch(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-caffe-model">Load Caffe Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadCaffe(&quot;/tmp/def/path&quot;, &quot;/tmp/model/path&quot;) //load from local fs
val model = Net.loadCaffe(&quot;hdfs://def/path&quot;, &quot;hdfs://model/path&quot;) //load from hdfs
val model = Net.loadCaffe(&quot;s3://def/path&quot;, &quot;s3://model/path&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadCaffe(&quot;/tmp/def/path&quot;, &quot;/tmp/model/path&quot;) //load from local fs
model = Net.loadCaffe(&quot;hdfs://def/path&quot;, &quot;hdfs://model/path&quot;) //load from hdfs
model = Net.loadCaffe(&quot;s3://def/path&quot;, &quot;s3://model/path&quot;) //load from s3
</code></pre>

<h3 id="load-tensorflow-model">Load TensorFlow model</h3>
<p>We also provides utilities to load tensorflow model.</p>
<p>If we already have a frozen graph protobuf file, we can use the <code>loadTF</code> api directly to
load the tensorflow model. </p>
<p>Otherwise, we should first use the <code>export_tf_checkpoint.py</code> script provided by BigDL's distribution
package, or the <code>dump_model</code> function defined in <a href="https://github.com/intel-analytics/BigDL/blob/master/pyspark/bigdl/util/tf_utils.py">here</a> to
generate the model definition file (<code>model.pb</code>) and variable binary file (<code>model.bin</code>). </p>
<p><strong>Use Script</strong></p>
<pre><code class="shell">GRAPH_META_FILE=/tmp/tensorflow/model.ckpt.meta
CKPT_FILE_PREFIX=/tmp/tensorflow/model.ckpt
SAVE_PATH=/tmp/model/
python export_tf_checkpoint.py $GRAPH_META_FILE $CKPT_FILE_PREFIX $SAVE_PATH
</code></pre>

<p><strong>Use python function</strong></p>
<pre><code class="python">import tensorflow as tf

# This is your model definition.
xs = tf.placeholder(tf.float32, [None, 1])

W1 = tf.Variable(tf.zeros([1,10])+0.2)
b1 = tf.Variable(tf.zeros([10])+0.1)
Wx_plus_b1 = tf.nn.bias_add(tf.matmul(xs,W1), b1)
output = tf.nn.tanh(Wx_plus_b1, name=&quot;output&quot;)

# Adding the following lines right after your model definition 
from bigdl.util.tf_utils import dump_model
dump_model_path = &quot;/tmp/model&quot;
# This line of code will create a Session and initialized all the Variable and
# save the model definition and variable to dump_model_path as BigDL readable format.
dump_model(path=dump_model_path)
</code></pre>

<p>Then we can use the <code>loadTF</code> api to load the tensorflow model into BigDL.</p>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val modelPath = &quot;/tmp/model/model.pb&quot;
val binPath = &quot;/tmp/model/model.bin&quot;
val inputs = Seq(&quot;Placeholder&quot;)
val outputs = Seq(&quot;output&quot;)

// For tensorflow frozen graph or graph without Variables
val model = Net.loadTF(modelPath, inputs, outputs, ByteOrder.LITTLE_ENDIAN)

// For tensorflow graph with Variables
val model = Net.loadTF(modelPath, inputs, outputs, ByteOrder.LITTLE_ENDIAN, Some(binPath))
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model_def = &quot;/tmp/model/model.pb&quot;
model_variable = &quot;/tmp/model/model.bin&quot;
inputs = [&quot;Placeholder&quot;]
outputs = [&quot;output&quot;]
# For tensorflow frozen graph or graph without Variables
model = Net.load_tensorflow(model_def, inputs, outputs, byte_order = &quot;little_endian&quot;, bigdl_type=&quot;float&quot;)

# For tensorflow graph with Variables
model = Net.load_tensorflow(model_def, inputs, outputs, byte_order = &quot;little_endian&quot;, bigdl_type=&quot;float&quot;, bin_file=model_variable)
</code></pre>

<h2 id="tfnet">TFNet</h2>
<p>TFNet is a analytics-zoo layer that wraps a tensorflow frozen graph and can easily run in parallel.</p>
<p>The difference between Net.loadTF() is that TFNet will call tensorflow's java api to do the computation.</p>
<p>TFNet cannot be trained, so it can only be used for inference or as a feature extractor for fine tuning a model.
When used as feature extractor, there should not be any trainable layers before TFNet, as all the gradient
from TFNet is set to zero.</p>
<p><strong>Note</strong>: This feature currently supports <strong>tensorflow 1.10</strong> and requires the OS to be one of the following 64-bit systems.
<strong>Ubuntu 16.04 or later</strong>, <strong>macOS 10.12.6 or later</strong> and <strong>Windows 7 or later</strong>.</p>
<p>To run on other system may require you to manually compile the TensorFlow source code. Instructions can
be found <a href="https://github.com/tensorflow/tensorflow/tree/v1.10.0/tensorflow/java">here</a>.</p>
<h3 id="export-tensorflow-model-to-frozen-inference-graph">Export TensorFlow model to frozen inference graph</h3>
<p>Analytics-zoo provides a useful utility function, <code>export_tf</code>, to export a TensorFlow model
to frozen inference graph.</p>
<p>For example:</p>
<p><strong>Python:</strong></p>
<pre><code class="python">import tensorflow as tf
from nets import inception
slim = tf.contrib.slim

images = tf.placeholder(dtype=tf.float32, shape=(None, 224, 224, 3))

with slim.arg_scope(inception.inception_v1_arg_scope()):
    logits, end_points = inception.inception_v1(images, num_classes=1001, is_training=False)

sess = tf.Session()
saver = tf.train.Saver()
saver.restore(sess, &quot;/tmp/models/inception_v1.ckpt&quot;)

from zoo.util.tf import export_tf
export_tf(sess, &quot;/tmp/models/tfnet&quot;, inputs=[images], outputs=[logits])
</code></pre>

<p>In the above code, the <code>export_tf</code> utility function will frozen the TensorFlow graph, strip unused operation according to the inputs and outputs and save it to the specified directory along with the input/output tensor names. </p>
<h3 id="creating-a-tfnet">Creating a TFNet</h3>
<p>After we have export the TensorFlow model, we can easily create a TFNet.</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val m = TFNet(&quot;/tmp/models/tfnet&quot;)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">m = TFNet.from_export_folder(&quot;/tmp/models/tfnet&quot;)
</code></pre>

<p>Please refer to <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/zoo/src/main/scala/com/intel/analytics/zoo/examples/tfnet">TFNet Object Detection Example (Scala)</a>
or <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/pyzoo/zoo/examples/tensorflow/tfnet">TFNet Object Detection Example (Python)</a> and
the <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/apps/tfnet">Image Classification Using TFNet Notebook</a> for more information.</p>
<h2 id="tfdataset">TFDataset</h2>
<p>TFDatset represents a distributed collection of elements to be feed into TensorFlow graph.
TFDatasets can be created using a RDD and each of its records is a list of numpy.ndarray representing
the tensors to be feed into TensorFlow graph on each iteration. TFDatasets must be used with the
TFOptimizer or TFPredictor.</p>
<p><strong>Note</strong>: This feature currently requires <strong>tensorflow 1.10</strong> and OS is one of the following 64-bit systems.
<strong>Ubuntu 16.04 or later</strong>, <strong>macOS 10.12.6 or later</strong> and <strong>Windows 7 or later</strong>.</p>
<p>To run on other system may require you to manually compile the TensorFlow source code. Instructions can
be found <a href="https://github.com/tensorflow/tensorflow/tree/v1.10.0/tensorflow/java">here</a>.</p>
<h3 id="methods">Methods</h3>
<h4 id="from_rdd">from_rdd</h4>
<p>Create a TFDataset from a rdd, each element of the rdd must be a list of numpy.ndarray.</p>
<p><strong>Python</strong></p>
<pre><code class="python">from_rdd(rdd, features, labels=None, batch_size=-1, batch_per_thread=-1, hard_code_batch_size=False, val_rdd=None)
</code></pre>

<p><strong>Arguments</strong></p>
<ul>
<li><strong>rdd</strong>: a rdd of list of numpy.ndarray each representing a tensor to feed into
        tensorflow graph on each iteration</li>
<li>
<p><strong>features</strong>: the structure of input features, should one the following:</p>
<ul>
<li>a tuple (dtype, shape), e.g. (tf.float32, [28, 28, 1]) </li>
<li>a list of such tuple [(dtype1, shape1), (dtype2, shape2)],
                 e.g. [(tf.float32, [10]), (tf.float32, [20])],</li>
<li>a dict of such tuple, mapping string names to tuple {"name": (dtype, shape},
                 e.g. {"input1":(tf.float32, [10]), "input2": (tf.float32, [20])}</li>
</ul>
</li>
<li>
<p><strong>labels</strong>: the structure of input labels, format is the same as features</p>
</li>
<li><strong>batch_size</strong>: the batch size, used for training, should be a multiple of
        total core num</li>
<li><strong>batch_per_thread</strong>: the batch size for each thread, used for inference or evaluation</li>
<li><strong>hard_code_batch_size</strong>: whether to hard code the batch_size into tensorflow graph,
        if True, the static size of the first dimension of the resulting tensors is
        batch_size/total_core_num (training) or batch_per_thread for inference; if False,
        it is None.</li>
<li><strong>val_rdd</strong>: validation data with the same structure of rdd</li>
</ul>
<h4 id="from_ndarrays">from_ndarrays</h4>
<p>Create a TFDataset from a nested structure of numpy ndarrays. Each element
in the resulting TFDataset has the same structure of the argument tensors and
is created by indexing on the first dimension of each ndarray in the tensors
argument.</p>
<p>This method is equivalent to sc.parallize the tensors and call TFDataset.from_rdd</p>
<p><strong>Python</strong></p>
<pre><code class="python">from_ndarrays(tensors, batch_size=-1, batch_per_thread=-1, hard_code_batch_size=False, val_tensors=None)
</code></pre>

<p><strong>Arguments</strong></p>
<ul>
<li><strong>tensors</strong>: the numpy ndarrays</li>
<li><strong>batch_size</strong>: the batch size, used for training, should be a multiple of
        total core num</li>
<li><strong>batch_per_thread</strong>: the batch size for each thread, used for inference or evaluation</li>
<li><strong>hard_code_batch_size</strong>: whether to hard code the batch_size into tensorflow graph,
        if True, the static size of the first dimension of the resulting tensors is
        batch_size/total_core_num (training) or batch_per_thread for inference; if False,
        it is None.</li>
<li><strong>val_tensors</strong>: the numpy ndarrays used for validation during training</li>
</ul>
<h4 id="from_image_set">from_image_set</h4>
<p>Create a TFDataset from a ImagetSet. Each ImageFeature in the ImageSet should
already has the "sample" field, i.e. the result of ImageSetToSample transformer</p>
<p><strong>Python</strong></p>
<pre><code class="python">from_image_set(image_set, image, label=None, batch_size=-1, batch_per_thread=-1, hard_code_batch_size=False, validation_image_set=None)
</code></pre>

<p><strong>Arguments</strong></p>
<ul>
<li><strong>image_set</strong>: the ImageSet used to create this TFDataset</li>
<li><strong>image</strong>: a tuple of two, the first element is the type of image, the second element
        is the shape of this element, i.e. (tf.float32, [224, 224, 3]))</li>
<li><strong>label</strong>: a tuple of two, the first element is the type of label, the second element
        is the shape of this element, i.e. (tf.int32, [1]))</li>
<li><strong>batch_size</strong>: the batch size, used for training, should be a multiple of
        total core num</li>
<li><strong>batch_per_thread</strong>: the batch size for each thread, used for inference or evaluation</li>
<li><strong>hard_code_batch_size</strong>: whether to hard code the batch_size into tensorflow graph,
        if True, the static size of the first dimension of the resulting tensors is
        batch_size/total_core_num (training) or batch_per_thread for inference; if False,
        it is None.</li>
<li><strong>validation_image_set</strong>: the ImageSet used for validation during training</li>
</ul>
<h4 id="from_text_set">from_text_set</h4>
<p>Create a TFDataset from a TextSet. The TextSet must be transformed to Sample, i.e.
the result of TextFeatureToSample transformer.</p>
<p><strong>Python</strong></p>
<pre><code class="python">from_text_set(text_set, text, label=None, batch_size=-1, batch_per_thread=-1, hard_code_batch_size=False, validation_image_set=None)
</code></pre>

<p><strong>Arguments</strong></p>
<ul>
<li><strong>text_set</strong>: the TextSet used to create this TFDataset</li>
<li><strong>text</strong>: a tuple of two, the first element is the type of this input feature,
        the second element is the shape of this element, i.e. (tf.float32, [10, 100, 4])).
        text can also be nested structure of this tuple of two.</li>
<li><strong>label</strong>: a tuple of two, the first element is the type of label, the second element
        is the shape of this element, i.e. (tf.int32, [1])). label can also be nested structure of
        this tuple of two.</li>
<li><strong>batch_size</strong>: the batch size, used for training, should be a multiple of
        total core num</li>
<li><strong>batch_per_thread</strong>: the batch size for each thread, used for inference or evaluation</li>
<li><strong>hard_code_batch_size</strong>: whether to hard code the batch_size into tensorflow graph,
        if True, the static size of the first dimension of the resulting tensors is
        batch_size/total_core_num (training) or batch_per_thread for inference; if False,
        it is None.</li>
<li><strong>validation_image_set</strong>: The TextSet used for validation during training</li>
</ul>
<h4 id="from_feature_set">from_feature_set</h4>
<p>Create a TFDataset from a FeatureSet. Currently, the element in this Feature set must be a
ImageFeature that has a sample field, i.e. the result of ImageSetToSample transformer</p>
<p><strong>Python</strong></p>
<pre><code class="python">from_feature_set(dataset, features, labels=None, batch_size=-1, batch_per_thread=-1, hard_code_batch_size=False, validation_dataset=None)
</code></pre>

<p><strong>Arguments</strong></p>
<ul>
<li><strong>dataset</strong>: the feature set used to create this TFDataset</li>
<li><strong>features</strong>: a tuple of two, the first element is the type of this input feature,
        the second element is the shape of this element, i.e. (tf.float32, [224, 224, 3])).
        text can also be nested structure of this tuple of two.</li>
<li><strong>labels</strong>: a tuple of two, the first element is the type of label, the second element
        is the shape of this element, i.e. (tf.int32, [1])). label can also be nested structure of
        this tuple of two.</li>
<li><strong>batch_size</strong>: the batch size, used for training, should be a multiple of
        total core num</li>
<li><strong>batch_per_thread</strong>: the batch size for each thread, used for inference or evaluation</li>
<li><strong>hard_code_batch_size</strong>: whether to hard code the batch_size into tensorflow graph,
        if True, the static size of the first dimension of the resulting tensors is
        batch_size/total_core_num (training) or batch_per_thread for inference; if False,
        it is None.</li>
<li><strong>validation_dataset</strong>: The FeatureSet used for validation during training</li>
</ul>
<h2 id="tfoptimizer">TFOptimizer</h2>
<p>TFOptimizer is the class that does all the hard work in distributed training, such as model
distribution and parameter synchronization. There are two ways to create a TFOptimizer.</p>
<p>The <code>from_loss</code> API takes the <strong>loss</strong> (a scalar tensor) as input and runs
stochastic gradient descent using the given <strong>optimMethod</strong> on all the <strong>Variables</strong> that contributing
to this loss.</p>
<p>The <code>from_keras</code> API takes a compiled <strong>Keras Model</strong> and a <strong>TFDataset</strong> and runs stochastic gradient
descent using the loss function, optimizer and metrics specified by the Keras model.</p>
<p><strong>Note</strong>: This feature currently requires <strong>tensorflow 1.10</strong> and OS is one of the following 64-bit systems.
<strong>Ubuntu 16.04 or later</strong>, <strong>macOS 10.12.6 or later</strong> and <strong>Windows 7 or later</strong>.</p>
<p>To run on other system may require you to manually compile the TensorFlow source code. Instructions can
be found <a href="https://github.com/tensorflow/tensorflow/tree/v1.10.0/tensorflow/java">here</a>.</p>
<p><strong>Python</strong></p>
<pre><code class="python">loss = ...
optimizer = TFOptimizer.from_loss(loss, Adam(1e-3))
optimizer.optimize(end_trigger=MaxEpoch(5))
</code></pre>

<p>For Keras model:</p>
<pre><code class="python">

model = Model(inputs=..., outputs=...)

model.compile(optimizer='rmsprop',
            loss='sparse_categorical_crossentropy',
            metrics=['accuracy'])

optimizer = TFOptimizer.from_keras(model, dataset)
optimizer.optimize(end_trigger=MaxEpoch(5))
</code></pre>

<h2 id="tfpredictor">TFPredictor</h2>
<p>TFPredictor takes a list of TensorFlow tensors as the model outputs and feed all the elements in
 TFDatasets to produce those outputs and returns a Spark RDD with each of its elements representing the
 model prediction for the corresponding input elements.</p>
<p><strong>Note</strong>: This feature currently requires <strong>tensorflow 1.10</strong> and OS is one of the following 64-bit systems.
 <strong>Ubuntu 16.04 or later</strong>, <strong>macOS 10.12.6 or later</strong> and <strong>Windows 7 or later</strong>.</p>
<p>To run on other system may require you to manually compile the TensorFlow source code. Instructions can
 be found <a href="https://github.com/tensorflow/tensorflow/tree/v1.10.0/tensorflow/java">here</a>.</p>
<p><strong>Python</strong></p>
<pre><code class="python">logist = ...
predictor = TFPredictor.from_outputs(sess, [logits])
predictions_rdd = predictor.predict()
</code></pre>

<p>For Keras model:</p>
<pre><code class="python">model = Model(inputs=..., outputs=...)
model.load_weights(&quot;/tmp/mnist_keras.h5&quot;)
predictor = TFPredictor.from_keras(model, dataset)
predictions_rdd = predictor.predict()
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
