<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>NNFrames - Analytics Zoo</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-125166209-1', 'analytics-zoo.github.io');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Analytics Zoo</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Overview</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Releases <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../release-download/">Download</a>
</li>
                                    
<li >
    <a href="../../../release-docs/">Documentation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Python</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../PythonUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/examples/">Examples</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/python-faq/">FAQ</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Scala</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ScalaUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../../ScalaUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../../ScalaUserGuide/examples/">Examples</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programming Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/nnframes/">DataFrame and ML Pipeline</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/autograd/">Autograd</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/transferlearning/">Transfer Learning</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/inference/">Model Serving</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/tensorflow/">TFPark</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-models/">Text Models</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/workingwithimages/">Working with Images</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/workingwithtexts/">Working with Texts</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Built-in Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/object-detection/">Object Detection API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/image-classification/">Image Classification API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-classification/">Text Classification API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/recommendation/">Recommendation API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/anomaly-detection/">Anomaly Detection API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-matching/">Text Matching API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/seq2seq/">Sequence to Sequence API</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../ProgrammingGuide/usercases-overview/">Reference Use Cases</a>
</li>
                                    
<li >
    <a href="../../../ProgrammingGuide/run-on-dataproc/">Run on Google Cloud Dataproc</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">White Paper <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../wp-bigdl/">BigDL</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">NNFrames</a>
</li>
            
<li >
    <a href="../math/">Autograd-Math</a>
</li>
            
<li >
    <a href="../variable/">Autograd-Variable</a>
</li>
            
<li >
    <a href="../net/">Net</a>
</li>
            
<li >
    <a href="../inference/">Inference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../TFPark/model/">KerasModel</a>
</li>
            
<li >
    <a href="../../TFPark/estimator/">TFEstimator</a>
</li>
            
<li >
    <a href="../../TFPark/text-models/">Text Models</a>
</li>
            
<li >
    <a href="../../TFPark/bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../FeatureEngineering/featureset/">FeatureSet</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/relation/">Relation</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/image/">Image</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/text/">Text</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../Models/object-detection/">Object Detection</a>
</li>
            
<li >
    <a href="../../Models/image-classification/">Image Classification</a>
</li>
            
<li >
    <a href="../../Models/text-classification/">Text Classification</a>
</li>
            
<li >
    <a href="../../Models/recommendation/">Recommendation</a>
</li>
            
<li >
    <a href="../../Models/anomaly-detection/">Anomaly Detection</a>
</li>
            
<li >
    <a href="../../Models/text-matching/">Text Matching</a>
</li>
            
<li >
    <a href="../../Models/seq2seq/">Sequence to Sequence</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Keras-Style API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../KerasStyleAPIGuide/keras-api-python/">Python Guide</a>
</li>
                                    
<li >
    <a href="../../../KerasStyleAPIGuide/keras-api-scala/">Scala Guide</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Layers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/activation/">Activation</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/initialization/">Initialization</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/core/">Core Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/convolutional/">Convolutional Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/pooling/">Pooling Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/recurrent/">Recurrent Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/normalization/">Normalization Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/embedding/">Embedding Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/dropout/">Dropout Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/advanced-activation/">Advanced Activations</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/wrappers/">Layer Wrappers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Optimization</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/training/">Train, evaluate or predict a model</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/optimizers/">Optimizers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/objectives/">Objectives</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../powered-by/">Powered by</a>
                            </li>
                            <li >
                                <a href="../../../presentations/">Presentations</a>
                            </li>
                            <li >
                                <a href="../../../known-issues/">FAQ and Known Issues</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../../wp-bigdl/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../math/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/intel-analytics/analytics-zoo/edit/master/docs/APIGuide/PipelineAPI/nnframes.md">Edit on Fork on GitHub </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#nnestimator">NNEstimator</a></li>
        <li class="main "><a href="#nnmodel">NNModel</a></li>
        <li class="main "><a href="#nnclassifier">NNClassifier</a></li>
        <li class="main "><a href="#nnclassifiermodel">NNClassifierModel</a></li>
        <li class="main "><a href="#hyperparameter-setting">Hyperparameter setting</a></li>
        <li class="main "><a href="#prepare-the-data-and-start-the-training-process">Prepare the data and start the training process</a></li>
        <li class="main "><a href="#make-prediction-on-chosen-data">Make prediction on chosen data</a></li>
        <li class="main "><a href="#nnimagereader">NNImageReader</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="nnestimator">NNEstimator</h2>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val estimator = NNEstimator(model, criterion)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">estimator = NNEstimator(model, criterion)
</code></pre>

<p><code>NNEstimator</code> extends <code>org.apache.spark.ml.Estimator</code> and supports training a BigDL
model with Spark DataFrame data. It can be integrated into a standard Spark ML Pipeline
to allow users to combine the components of BigDL and Spark MLlib.</p>
<p><code>NNEstimator</code> supports different feature and label data types through <code>Preprocessing</code>.
During fit (training), NNEstimator will extract feature and label data from input DataFrame and use
the <code>Preprocessing</code> to convert data for the model, typically converts the feature and label
to Tensors or converts the (feature, option[Label]) tuple to a BigDL <code>Sample</code>. </p>
<p>Each<code>Preprocessing</code> conducts a data conversion step in the preprocessing phase, multiple
<code>Preprocessing</code> can be combined into a <code>ChainedPreprocessing</code>. Some pre-defined 
<code>Preprocessing</code> for popular data types like Image, Array or Vector are provided in package
<code>com.intel.analytics.zoo.feature</code>, while user can also develop customized <code>Preprocessing</code>.</p>
<p>By default, <code>SeqToTensor</code> is used to convert an array or Vector to a 1-dimension Tensor.
Using the <code>Preprocessing</code> allows <code>NNEstimator</code> to cache only the raw data and decrease the 
memory consumption during feature conversion and training, it also enables the model to digest
extra data types that DataFrame does not support currently.</p>
<p>More concrete examples are available in package <code>com.intel.analytics.zoo.examples.nnframes</code></p>
<p><code>NNEstimator</code> can be created with various parameters for different scenarios.</p>
<p><strong>1.</strong> <code>NNEstimator(model, criterion)</code></p>
<p>Takes only model and criterion and use <code>SeqToTensor</code> as feature and label
   <code>Preprocessing</code>. <code>NNEstimator</code> will extract the data from feature and label columns (
   only Scalar, Array[_] or Vector data type are supported) and convert each feature/label to
   1-dimension Tensor. The tensors will be combined into BigDL <code>Sample</code> and send to model for
   training.</p>
<p><strong>2.</strong> <code>NNEstimator(model, criterion, featureSize: Array[Int], labelSize: Array[Int])</code></p>
<p>Takes model, criterion, featureSize(Array of Int) and labelSize(Array of Int). <code>NNEstimator</code>
   will extract the data from feature and label columns (only Scalar, Array[_] or Vector data
   type are supported) and convert each feature/label to Tensor according to the specified Tensor
   size.</p>
<p><strong>3.</strong> <code>NNEstimator(model, criterion, featurePreprocessing: Preprocessing[F, Tensor[T]],
labelPreprocessing: Preprocessing[F, Tensor[T]])</code></p>
<p>Takes model, criterion, featurePreprocessing and labelPreprocessing.  <code>NNEstimator</code>
   will extract the data from feature and label columns and convert each feature/label to Tensor
   with the featurePreprocessing and labelPreprocessing. This constructor provides more flexibility
   in supporting extra data types.</p>
<p>Meanwhile, for advanced use cases (e.g. model with multiple input tensor), <code>NNEstimator</code> supports:
<code>setSamplePreprocessing(value: Preprocessing[(Any, Option[Any]), Sample[T]])</code> to directly compose
Sample according to user-specified Preprocessing.</p>
<p><strong>Scala Example:</strong></p>
<pre><code class="scala">import com.intel.analytics.bigdl.nn._
import com.intel.analytics.zoo.pipeline.nnframes.NNEstimator
import com.intel.analytics.bigdl.tensor.TensorNumericMath.TensorNumeric.NumericFloat

val model = Sequential().add(Linear(2, 2))
val criterion = MSECriterion()
val estimator = NNEstimator(model, criterion)
  .setLearningRate(0.2)
  .setMaxEpoch(40)
val data = sc.parallelize(Seq(
  (Array(2.0, 1.0), Array(1.0, 2.0)),
  (Array(1.0, 2.0), Array(2.0, 1.0)),
  (Array(2.0, 1.0), Array(1.0, 2.0)),
  (Array(1.0, 2.0), Array(2.0, 1.0))))
val df = sqlContext.createDataFrame(data).toDF(&quot;features&quot;, &quot;label&quot;)
val nnModel = estimator.fit(df)
nnModel.transform(df).show(false)
</code></pre>

<p><strong>Python Example:</strong></p>
<pre><code class="python">from bigdl.nn.layer import *
from bigdl.nn.criterion import *
from bigdl.util.common import *
from zoo.pipeline.nnframes.nn_classifier import *
from zoo.feature.common import *

data = self.sc.parallelize([
    ((2.0, 1.0), (1.0, 2.0)),
    ((1.0, 2.0), (2.0, 1.0)),
    ((2.0, 1.0), (1.0, 2.0)),
    ((1.0, 2.0), (2.0, 1.0))])

schema = StructType([
    StructField(&quot;features&quot;, ArrayType(DoubleType(), False), False),
    StructField(&quot;label&quot;, ArrayType(DoubleType(), False), False)])
df = self.sqlContext.createDataFrame(data, schema)
model = Sequential().add(Linear(2, 2))
criterion = MSECriterion()
estimator = NNEstimator(model, criterion, SeqToTensor([2]), ArrayToTensor([2]))\
    .setBatchSize(4).setLearningRate(0.2).setMaxEpoch(40)
nnModel = estimator.fit(df)
res = nnModel.transform(df)
</code></pre>

<hr />
<h2 id="nnmodel">NNModel</h2>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val nnModel = NNModel(bigDLModel)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">nn_model = NNModel(bigDLModel)
</code></pre>

<p><code>NNModel</code> extends Spark's ML
<a href="https://spark.apache.org/docs/2.1.1/ml-pipeline.html#transformers">Transformer</a>. User can invoke
<code>fit</code> in <code>NNEstimator</code> to get a <code>NNModel</code>, or directly compose a <code>NNModel</code> from BigDLModel.
It enables users to wrap a pre-trained BigDL Model into a NNModel,
and use it as a transformer in your Spark ML pipeline to predict the results for <code>DataFrame
(DataSet)</code>. </p>
<p><code>NNModel</code> can be created with various parameters for different scenarios.</p>
<p><strong>1.</strong> <code>NNModel(model)</code></p>
<p>Takes only model and use <code>SeqToTensor</code> as feature Preprocessing. <code>NNModel</code> will extract the
   data from feature column (only Scalar, Array[_] or Vector data type are supported) and
   convert each feature to 1-dimension Tensor. The tensors will be sent to model for inference.</p>
<p><strong>2.</strong> <code>NNModel(model, featureSize: Array[Int])</code></p>
<p>Takes model and featureSize(Array of Int). <code>NNModel</code> will extract the data from feature
   column (only Scalar, Array[_] or Vector data type are supported) and convert each feature
   to Tensor according to the specified Tensor size.</p>
<p><strong>3.</strong> <code>NNModel(model, featurePreprocessing: Preprocessing[F, Tensor[T]])</code></p>
<p>Takes model and featurePreprocessing. <code>NNModel</code> will extract the data from feature column
   and convert each feature to Tensor with the featurePreprocessing. This constructor provides
   more flexibility in supporting extra data types.</p>
<p>Meanwhile, for advanced use cases (e.g. model with multiple input tensor), <code>NNModel</code> supports:
<code>setSamplePreprocessing(value: Preprocessing[Any, Sample[T]])</code>to directly compose
Sample according to user-specified Preprocessing.</p>
<hr />
<h2 id="nnclassifier">NNClassifier</h2>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val classifer =  NNClassifer(model, criterion)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">classifier = NNClassifer(model, criterion)
</code></pre>

<p><code>NNClassifier</code> is a specialized <code>NNEstimator</code> that simplifies the data format for
classification tasks where the label space is discrete. It only supports label column of
DoubleType, and the fitted <code>NNClassifierModel</code> will have the prediction column of 
DoubleType.</p>
<ul>
<li><code>model</code> BigDL module to be optimized in the fit() method</li>
<li><code>criterion</code> the criterion used to compute the loss and the gradient</li>
</ul>
<p><code>NNClassifier</code> can be created with various parameters for different scenarios.</p>
<p><strong>1.</strong> <code>NNClassifier(model, criterion)</code></p>
<p>Takes only model and criterion and use <code>SeqToTensor</code> as feature and label
   Preprocessing. <code>NNClassifier</code> will extract the data from feature and label columns (
   only Scalar, Array[_] or Vector data type are supported) and convert each feature/label to
   1-dimension Tensor. The tensors will be combined into BigDL samples and send to model for
   training.</p>
<p><strong>2.</strong> <code>NNClassifier(model, criterion, featureSize: Array[Int])</code></p>
<p>Takes model, criterion, featureSize(Array of Int). <code>NNClassifier</code>
   will extract the data from feature and label columns and convert each feature to Tensor
   according to the specified Tensor size. <code>ScalarToTensor</code> is used to convert the label column.</p>
<p><strong>3.</strong> <code>NNClassifier(model, criterion, featurePreprocessing: Preprocessing[F, Tensor[T]])</code></p>
<p>Takes model, criterion and featurePreprocessing.  <code>NNClassifier</code>
   will extract the data from feature and label columns and convert each feature to Tensor
   with the featurePreprocessing. This constructor provides more flexibility
   in supporting extra data types.</p>
<p>Meanwhile, for advanced use cases (e.g. model with multiple input tensor), <code>NNClassifier</code> supports:
<code>setSamplePreprocessing(value: Preprocessing[(Any, Option[Any]), Sample[T]])</code> to directly compose
Sample with user-specified Preprocessing.</p>
<p><strong>Scala example:</strong></p>
<pre><code class="scala">import com.intel.analytics.bigdl.nn._
import com.intel.analytics.zoo.pipeline.nnframes.NNClassifier
import com.intel.analytics.bigdl.tensor.TensorNumericMath.TensorNumeric.NumericFloat

val model = Sequential().add(Linear(2, 2))
val criterion = MSECriterion()
val estimator = NNClassifier(model, criterion)
  .setLearningRate(0.2)
  .setMaxEpoch(40)
val data = sc.parallelize(Seq(
  (Array(0.0, 1.0), 1.0),
  (Array(1.0, 0.0), 2.0),
  (Array(0.0, 1.0), 1.0),
  (Array(1.0, 0.0), 2.0)))
val df = sqlContext.createDataFrame(data).toDF(&quot;features&quot;, &quot;label&quot;)
val dlModel = estimator.fit(df)
dlModel.transform(df).show(false)
</code></pre>

<p><strong>Python Example:</strong></p>
<pre><code class="python">from bigdl.nn.layer import *
from bigdl.nn.criterion import *
from bigdl.util.common import *
from bigdl.dlframes.dl_classifier import *
from pyspark.sql.types import *

#Logistic Regression with BigDL layers and Analytics zoo NNClassifier
model = Sequential().add(Linear(2, 2)).add(LogSoftMax())
criterion = ClassNLLCriterion()
estimator = NNClassifier(model, criterion, [2]).setBatchSize(4).setMaxEpoch(10)
data = sc.parallelize([
    ((0.0, 1.0), [1.0]),
    ((1.0, 0.0), [2.0]),
    ((0.0, 1.0), [1.0]),
    ((1.0, 0.0), [2.0])])

schema = StructType([
    StructField(&quot;features&quot;, ArrayType(DoubleType(), False), False),
    StructField(&quot;label&quot;, ArrayType(DoubleType(), False), False)])
df = sqlContext.createDataFrame(data, schema)
dlModel = estimator.fit(df)
dlModel.transform(df).show(False)
</code></pre>

<h2 id="nnclassifiermodel">NNClassifierModel</h2>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val nnClassifierModel = NNClassifierModel(model, featureSize)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">nn_classifier_model = NNClassifierModel(model)
</code></pre>

<p>NNClassifierModel is a specialized <code>NNModel</code> for classification tasks.
Both label and prediction column will have the datatype of Double.</p>
<p><code>NNClassifierModel</code> can be created with various parameters for different scenarios.</p>
<p><strong>1.</strong> <code>NNClassifierModel(model)</code></p>
<p>Takes only model and use <code>SeqToTensor</code> as feature Preprocessing. <code>NNClassifierModel</code> will
   extract the data from feature column (only Scalar, Array[_] or Vector data type are supported)
   and convert each feature to 1-dimension Tensor. The tensors will be sent to model for inference.</p>
<p><strong>2.</strong> <code>NNClassifierModel(model, featureSize: Array[Int])</code></p>
<p>Takes model and featureSize(Array of Int). <code>NNClassifierModel</code> will extract the data from feature
   column (only Scalar, Array[_] or Vector data type are supported) and convert each feature
   to Tensor according to the specified Tensor size.</p>
<p><strong>3.</strong> <code>NNClassifierModel(model, featurePreprocessing: Preprocessing[F, Tensor[T]])</code></p>
<p>Takes model and featurePreprocessing. <code>NNClassifierModel</code> will extract the data from feature
   column and convert each feature to Tensor with the featurePreprocessing. This constructor provides
   more flexibility in supporting extra data types.</p>
<p>Meanwhile, for advanced use cases (e.g. model with multiple input tensor), <code>NNClassifierModel</code>
supports: <code>setSamplePreprocessing(value: Preprocessing[Any, Sample[T]])</code>to directly compose
Sample according to user-specified Preprocessing.</p>
<hr />
<h2 id="hyperparameter-setting">Hyperparameter setting</h2>
<p>Prior to the commencement of the training process, you can modify the optimization algorithm, batch 
size, the epoch number of your training, and learning rate to meet your goal or
<code>NNEstimator</code>/<code>NNClassifier</code> will use the default value.</p>
<p>Continue the codes above, NNEstimator and NNClassifier can be set in the same way.</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">//for esitmator
estimator.setBatchSize(4).setMaxEpoch(10).setLearningRate(0.01).setOptimMethod(new Adam())
//for classifier
classifier.setBatchSize(4).setMaxEpoch(10).setLearningRate(0.01).setOptimMethod(new Adam())
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python"># for esitmator
estimator.setBatchSize(4).setMaxEpoch(10).setLearningRate(0.01).setOptimMethod(Adam())
# for classifier
classifier.setBatchSize(4).setMaxEpoch(10).setLearningRate(0.01).setOptimMethod(Adam())

</code></pre>

<h2 id="prepare-the-data-and-start-the-training-process">Prepare the data and start the training process</h2>
<p>NNEstimator/NNCLassifer supports training with Spark's
<a href="https://spark.apache.org/docs/latest/sql-programming-guide.html#datasets-and-dataframes">DataFrame/DataSet</a></p>
<p>Suppose <code>df</code> is the training data, simple call <code>fit</code> method and let Analytics Zoo train the model
for you.</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">//get a NNClassifierModel
val nnClassifierModel = classifier.fit(df)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python"># get a NNClassifierModel
nnClassifierModel = classifier.fit(df)
</code></pre>

<p>User may also set validation DataFrame and validation frequency through <code>setValidation</code> method.
Train summay and validation summary can also be configured to log the training process for
visualization in Tensorboard.</p>
<h2 id="make-prediction-on-chosen-data">Make prediction on chosen data</h2>
<p>Since <code>NNModel</code>/<code>NNClassifierModel</code> inherits from Spark's <code>Transformer</code> abstract class, simply call 
<code>transform</code> method on <code>NNModel</code>/<code>NNClassifierModel</code> to make prediction.</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">nnModel.transform(df).show(false)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">nnModel.transform(df).show(false)
</code></pre>

<p>For the complete examples of NNFrames, please refer to:
<a href="https://github.com/intel-analytics/analytics-zoo/tree/master/zoo/src/main/scala/com/intel/analytics/zoo/examples/nnframes">Scala examples</a>
<a href="https://github.com/intel-analytics/analytics-zoo/tree/master/pyzoo/zoo/examples/nnframes">Python examples</a></p>
<h2 id="nnimagereader">NNImageReader</h2>
<p><code>NNImageReader</code> is the primary DataFrame-based image loading interface, defining API to read images
into DataFrame.</p>
<p>Scala:</p>
<pre><code class="scala">    val imageDF = NNImageReader.readImages(imageDirectory, sc)
</code></pre>

<p>Python:</p>
<pre><code class="python">    image_frame = NNImageReader.readImages(image_path, self.sc)
</code></pre>

<p>The output DataFrame contains a sinlge column named "image". The schema of "image" column can be
accessed from <code>com.intel.analytics.zoo.pipeline.nnframes.DLImageSchema.byteSchema</code>.
Each record in "image" column represents one image record, in the format of
Row(origin, height, width, num of channels, mode, data), where origin contains the URI for the image file,
and <code>data</code> holds the original file bytes for the image file. <code>mode</code> represents the OpenCV-compatible
type: CV_8UC3, CV_8UC1 in most cases.</p>
<pre><code class="scala">  val byteSchema = StructType(
    StructField(&quot;origin&quot;, StringType, true) ::
      StructField(&quot;height&quot;, IntegerType, false) ::
      StructField(&quot;width&quot;, IntegerType, false) ::
      StructField(&quot;nChannels&quot;, IntegerType, false) ::
      // OpenCV-compatible type: CV_8UC3, CV_32FC3 in most cases
      StructField(&quot;mode&quot;, IntegerType, false) ::
      // Bytes in OpenCV-compatible order: row-wise BGR in most cases
      StructField(&quot;data&quot;, BinaryType, false) :: Nil)
</code></pre>

<p>After loading the image, user can compose the preprocess steps with the <code>Preprocessing</code> defined
in <code>com.intel.analytics.zoo.feature.image</code>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
