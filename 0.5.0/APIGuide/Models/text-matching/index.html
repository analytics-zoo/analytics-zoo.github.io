<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Text Matching - Analytics Zoo</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-125166209-1', 'analytics-zoo.github.io');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Analytics Zoo</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Overview</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Releases <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../release-download/">Download</a>
</li>
                                    
<li >
    <a href="../../../release-docs/">Documentation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Python</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../PythonUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/examples/">Examples</a>
</li>
            
<li >
    <a href="../../../PythonUserGuide/python-faq/">FAQ</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Scala</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ScalaUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../../ScalaUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../../ScalaUserGuide/examples/">Examples</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programming Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/nnframes/">DataFrame and ML Pipeline</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/autograd/">Autograd</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/transferlearning/">Transfer Learning</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/inference/">Model Serving</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/tensorflow/">TFPark</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-models/">Text Models</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/workingwithimages/">Working with Images</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/workingwithtexts/">Working with Texts</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Built-in Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ProgrammingGuide/object-detection/">Object Detection API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/image-classification/">Image Classification API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-classification/">Text Classification API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/recommendation/">Recommendation API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/anomaly-detection/">Anomaly Detection API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/text-matching/">Text Matching API</a>
</li>
            
<li >
    <a href="../../../ProgrammingGuide/seq2seq/">Sequence to Sequence API</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../ProgrammingGuide/usercases-overview/">Reference Use Cases</a>
</li>
                                    
<li >
    <a href="../../../ProgrammingGuide/run-on-dataproc/">Run on Google Cloud Dataproc</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">White Paper <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../wp-bigdl/">BigDL</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../PipelineAPI/nnframes/">NNFrames</a>
</li>
            
<li >
    <a href="../../PipelineAPI/math/">Autograd-Math</a>
</li>
            
<li >
    <a href="../../PipelineAPI/variable/">Autograd-Variable</a>
</li>
            
<li >
    <a href="../../PipelineAPI/net/">Net</a>
</li>
            
<li >
    <a href="../../PipelineAPI/inference/">Inference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../TFPark/model/">KerasModel</a>
</li>
            
<li >
    <a href="../../TFPark/estimator/">TFEstimator</a>
</li>
            
<li >
    <a href="../../TFPark/text-models/">Text Models</a>
</li>
            
<li >
    <a href="../../TFPark/bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../FeatureEngineering/featureset/">FeatureSet</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/relation/">Relation</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/image/">Image</a>
</li>
            
<li >
    <a href="../../FeatureEngineering/text/">Text</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../object-detection/">Object Detection</a>
</li>
            
<li >
    <a href="../image-classification/">Image Classification</a>
</li>
            
<li >
    <a href="../text-classification/">Text Classification</a>
</li>
            
<li >
    <a href="../recommendation/">Recommendation</a>
</li>
            
<li >
    <a href="../anomaly-detection/">Anomaly Detection</a>
</li>
            
<li class="active">
    <a href="./">Text Matching</a>
</li>
            
<li >
    <a href="../seq2seq/">Sequence to Sequence</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Keras-Style API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../KerasStyleAPIGuide/keras-api-python/">Python Guide</a>
</li>
                                    
<li >
    <a href="../../../KerasStyleAPIGuide/keras-api-scala/">Scala Guide</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Layers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/activation/">Activation</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/initialization/">Initialization</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/core/">Core Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/convolutional/">Convolutional Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/pooling/">Pooling Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/recurrent/">Recurrent Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/normalization/">Normalization Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/embedding/">Embedding Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/dropout/">Dropout Layers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/advanced-activation/">Advanced Activations</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Layers/wrappers/">Layer Wrappers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Optimization</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/training/">Train, evaluate or predict a model</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/optimizers/">Optimizers</a>
</li>
            
<li >
    <a href="../../../KerasStyleAPIGuide/Optimization/objectives/">Objectives</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../powered-by/">Powered by</a>
                            </li>
                            <li >
                                <a href="../../../presentations/">Presentations</a>
                            </li>
                            <li >
                                <a href="../../../known-issues/">FAQ and Known Issues</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../anomaly-detection/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../seq2seq/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/intel-analytics/analytics-zoo/edit/master/docs/APIGuide/Models/text-matching.md">Edit on Fork on GitHub </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#build-a-knrm-model">Build a KNRM Model</a></li>
        <li class="main "><a href="#save-model">Save Model</a></li>
        <li class="main "><a href="#load-model">Load Model</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Analytics Zoo provides a pre-defined KNRM model that can be used for text matching (e.g. question answering).
For training, you can use Keras-Style API methods or alternatively feed the model into NNFrames and BigDL Optimizer.
More text matching models will be supported in the future.</p>
<hr />
<h2 id="build-a-knrm-model"><strong>Build a KNRM Model</strong></h2>
<p>Kernel-pooling Neural Ranking Model with RBF kernel. See <a href="https://arxiv.org/abs/1706.06613">here</a> for more details.</p>
<p>You can call the following API in Scala and Python respectively to create a <code>KNRM</code> with <em>pre-trained GloVe word embeddings</em>.</p>
<p><strong>Scala</strong></p>
<pre><code class="scala">val knrm = KNRM(text1Length, text2Length, embeddingFile, wordIndex = null, trainEmbed = true, kernelNum = 21, sigma = 0.1, exactSigma = 0.001, targetMode = &quot;ranking&quot;)
</code></pre>

<ul>
<li><code>text1Length</code>: Sequence length of text1 (query).</li>
<li><code>text2Length</code>: Sequence length of text2 (doc).</li>
<li><code>embeddingFile</code>: The path to the word embedding file. Currently only <em>glove.6B.50d.txt, glove.6B.100d.txt, glove.6B.200d.txt, glove.6B.300d.txt, glove.42B.300d.txt, glove.840B.300d.txt</em> are supported. You can download from <a href="https://nlp.stanford.edu/projects/glove/">here</a>.</li>
<li><code>wordIndex</code>: Map of word (String) and its corresponding index (integer). The index is supposed to <strong>start from 1</strong> with 0 reserved for unknown words. During the prediction, if you have words that are not in the wordIndex for the training, you can map them to index 0. Default is null. In this case, all the words in the embeddingFile will be taken into account and you can call <code>WordEmbedding.getWordIndex(embeddingFile)</code> to retrieve the map.</li>
<li><code>trainEmbed</code>: Boolean. Whether to train the embedding layer or not. Default is true.</li>
<li><code>kernelNum</code>: Integer &gt; 1. The number of kernels to use. Default is 21.</li>
<li><code>sigma</code>: Double. Defines the kernel width, or the range of its softTF count. Default is 0.1.</li>
<li><code>exactSigma</code>: Double. The sigma used for the kernel that harvests exact matches in the case where RBF mu=1.0. Default is 0.001.</li>
<li><code>targetMode</code>: String. The target mode of the model. Either 'ranking' or 'classification'. For ranking, the output will be the relevance score between text1 and text2 and you are recommended to use 'rank_hinge' as loss for pairwise training.
For classification, the last layer will be sigmoid and the output will be the probability between 0 and 1 indicating whether text1 is related to text2 and
you are recommended to use 'binary_crossentropy' as loss for binary classification. Default mode is 'ranking'.</li>
</ul>
<p>See <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/zoo/src/main/scala/com/intel/analytics/zoo/examples/qaranker">here</a> for the Scala example that trains a KNRM model on WikiQA dataset.</p>
<p><strong>Python</strong></p>
<pre><code class="python">knrm = KNRM(text1_length, text2_length, embedding_file, word_index=None, train_embed=True, kernel_num=21, sigma=0.1, exact_sigma=0.001, target_mode=&quot;ranking&quot;)
</code></pre>

<ul>
<li><code>text1_length</code>: Sequence length of text1 (query).</li>
<li><code>text2_length</code>: Sequence length of text2 (doc).</li>
<li><code>embedding_file</code>: The path to the word embedding file. Currently only <em>glove.6B.50d.txt, glove.6B.100d.txt, glove.6B.200d.txt, glove.6B.300d.txt, glove.42B.300d.txt, glove.840B.300d.txt</em> are supported. You can download from <a href="https://nlp.stanford.edu/projects/glove/">here</a>.</li>
<li><code>word_index</code>: Dictionary of word (string) and its corresponding index (int). The index is supposed to <strong>start from 1</strong> with 0 reserved for unknown words. During the prediction, if you have words that are not in the wordIndex for the training, you can map them to index 0. Default is None. In this case, all the words in the embedding_file will be taken into account and you can call <code>WordEmbedding.get_word_index(embedding_file)</code> to retrieve the dictionary.</li>
<li><code>train_embed</code>: Boolean. Whether to train the embedding layer or not. Default is True.</li>
<li><code>kernel_num</code>: Int &gt; 1. The number of kernels to use. Default is 21.</li>
<li><code>sigma</code>: Float. Defines the kernel width, or the range of its softTF count. Default is 0.1.</li>
<li><code>exact_sigma</code>: Float. The sigma used for the kernel that harvests exact matches in the case where RBF mu=1.0. Default is 0.001.</li>
<li><code>target_mode</code>: String. The target mode of the model. Either 'ranking' or 'classification'. For ranking, the output will be the relevance score between text1 and text2 and you are recommended to use 'rank_hinge' as loss for pairwise training.
For classification, the last layer will be sigmoid and the output will be the probability between 0 and 1 indicating whether text1 is related to text2 and
you are recommended to use 'binary_crossentropy' as loss for binary classification. Default mode is 'ranking'.</li>
</ul>
<p>See <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/pyzoo/zoo/examples/qaranker">here</a> for the Python example that trains a KNRM model on WikiQA dataset.</p>
<hr />
<h2 id="save-model"><strong>Save Model</strong></h2>
<p>After building and training a KNRM model, you can save it for future use.</p>
<p><strong>Scala</strong></p>
<pre><code class="scala">knrm.saveModel(path, weightPath = null, overWrite = false)
</code></pre>

<ul>
<li><code>path</code>: The path to save the model. Local file system, HDFS and Amazon S3 are supported. HDFS path should be like "hdfs://[host]:[port]/xxx". Amazon S3 path should be like "s3a://bucket/xxx".</li>
<li><code>weightPath</code>: The path to save weights. Default is null.</li>
<li><code>overWrite</code>: Whether to overwrite the file if it already exists. Default is false.</li>
</ul>
<p><strong>Python</strong></p>
<pre><code class="python">knrm.save_model(path, weight_path=None, over_write=False)
</code></pre>

<ul>
<li><code>path</code>: The path to save the model. Local file system, HDFS and Amazon S3 are supported. HDFS path should be like 'hdfs://[host]:[port]/xxx'. Amazon S3 path should be like 's3a://bucket/xxx'.</li>
<li><code>weight_path</code>: The path to save weights. Default is None.</li>
<li><code>over_write</code>: Whether to overwrite the file if it already exists. Default is False.</li>
</ul>
<hr />
<h2 id="load-model"><strong>Load Model</strong></h2>
<p>To load a KNRM model (with weights) saved <a href="#save-model">above</a>:</p>
<p><strong>Scala</strong></p>
<pre><code class="scala">KNRM.loadModel(path, weightPath = null)
</code></pre>

<ul>
<li><code>path</code>: The path for the pre-defined model. Local file system, HDFS and Amazon S3 are supported. HDFS path should be like "hdfs://[host]:[port]/xxx". Amazon S3 path should be like "s3a://bucket/xxx".</li>
<li><code>weightPath</code>: The path for pre-trained weights if any. Default is null.</li>
</ul>
<p><strong>Python</strong></p>
<pre><code class="python">KNRM.load_model(path, weight_path=None)
</code></pre>

<ul>
<li><code>path</code>: The path for the pre-defined model. Local file system, HDFS and Amazon S3 are supported. HDFS path should be like 'hdfs://[host]:[port]/xxx'. Amazon S3 path should be like 's3a://bucket/xxx'.</li>
<li><code>weight_path</code>: The path for pre-trained weights if any. Default is None.</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
