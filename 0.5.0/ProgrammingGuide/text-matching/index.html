<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Text Matching API - Analytics Zoo</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-125166209-1', 'analytics-zoo.github.io');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Analytics Zoo</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Overview</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Releases <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../release-download/">Download</a>
</li>
                                    
<li >
    <a href="../../release-docs/">Documentation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Python</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../PythonUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../PythonUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../PythonUserGuide/examples/">Examples</a>
</li>
            
<li >
    <a href="../../PythonUserGuide/python-faq/">FAQ</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Scala</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ScalaUserGuide/install/">Install</a>
</li>
            
<li >
    <a href="../../ScalaUserGuide/run/">Run</a>
</li>
            
<li >
    <a href="../../ScalaUserGuide/examples/">Examples</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programming Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../nnframes/">DataFrame and ML Pipeline</a>
</li>
            
<li >
    <a href="../autograd/">Autograd</a>
</li>
            
<li >
    <a href="../transferlearning/">Transfer Learning</a>
</li>
            
<li >
    <a href="../inference/">Model Serving</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../tensorflow/">TFPark</a>
</li>
            
<li >
    <a href="../text-models/">Text Models</a>
</li>
            
<li >
    <a href="../bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../workingwithimages/">Working with Images</a>
</li>
            
<li >
    <a href="../workingwithtexts/">Working with Texts</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Built-in Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../object-detection/">Object Detection API</a>
</li>
            
<li >
    <a href="../image-classification/">Image Classification API</a>
</li>
            
<li >
    <a href="../text-classification/">Text Classification API</a>
</li>
            
<li >
    <a href="../recommendation/">Recommendation API</a>
</li>
            
<li >
    <a href="../anomaly-detection/">Anomaly Detection API</a>
</li>
            
<li class="active">
    <a href="./">Text Matching API</a>
</li>
            
<li >
    <a href="../seq2seq/">Sequence to Sequence API</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../usercases-overview/">Reference Use Cases</a>
</li>
                                    
<li >
    <a href="../run-on-dataproc/">Run on Google Cloud Dataproc</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">White Paper <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../wp-bigdl/">BigDL</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Pipeline APIs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../APIGuide/PipelineAPI/nnframes/">NNFrames</a>
</li>
            
<li >
    <a href="../../APIGuide/PipelineAPI/math/">Autograd-Math</a>
</li>
            
<li >
    <a href="../../APIGuide/PipelineAPI/variable/">Autograd-Variable</a>
</li>
            
<li >
    <a href="../../APIGuide/PipelineAPI/net/">Net</a>
</li>
            
<li >
    <a href="../../APIGuide/PipelineAPI/inference/">Inference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TFPark API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../APIGuide/TFPark/model/">KerasModel</a>
</li>
            
<li >
    <a href="../../APIGuide/TFPark/estimator/">TFEstimator</a>
</li>
            
<li >
    <a href="../../APIGuide/TFPark/text-models/">Text Models</a>
</li>
            
<li >
    <a href="../../APIGuide/TFPark/bert-classifier/">BERT Classifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Feature Engineering</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../APIGuide/FeatureEngineering/featureset/">FeatureSet</a>
</li>
            
<li >
    <a href="../../APIGuide/FeatureEngineering/relation/">Relation</a>
</li>
            
<li >
    <a href="../../APIGuide/FeatureEngineering/image/">Image</a>
</li>
            
<li >
    <a href="../../APIGuide/FeatureEngineering/text/">Text</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../APIGuide/Models/object-detection/">Object Detection</a>
</li>
            
<li >
    <a href="../../APIGuide/Models/image-classification/">Image Classification</a>
</li>
            
<li >
    <a href="../../APIGuide/Models/text-classification/">Text Classification</a>
</li>
            
<li >
    <a href="../../APIGuide/Models/recommendation/">Recommendation</a>
</li>
            
<li >
    <a href="../../APIGuide/Models/anomaly-detection/">Anomaly Detection</a>
</li>
            
<li >
    <a href="../../APIGuide/Models/text-matching/">Text Matching</a>
</li>
            
<li >
    <a href="../../APIGuide/Models/seq2seq/">Sequence to Sequence</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Keras-Style API Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../KerasStyleAPIGuide/keras-api-python/">Python Guide</a>
</li>
                                    
<li >
    <a href="../../KerasStyleAPIGuide/keras-api-scala/">Scala Guide</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Layers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/activation/">Activation</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/initialization/">Initialization</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/core/">Core Layers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/convolutional/">Convolutional Layers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/pooling/">Pooling Layers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/recurrent/">Recurrent Layers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/normalization/">Normalization Layers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/embedding/">Embedding Layers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/dropout/">Dropout Layers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/advanced-activation/">Advanced Activations</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Layers/wrappers/">Layer Wrappers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Optimization</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../KerasStyleAPIGuide/Optimization/training/">Train, evaluate or predict a model</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Optimization/optimizers/">Optimizers</a>
</li>
            
<li >
    <a href="../../KerasStyleAPIGuide/Optimization/objectives/">Objectives</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../powered-by/">Powered by</a>
                            </li>
                            <li >
                                <a href="../../presentations/">Presentations</a>
                            </li>
                            <li >
                                <a href="../../known-issues/">FAQ and Known Issues</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../anomaly-detection/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../seq2seq/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/intel-analytics/analytics-zoo/edit/master/docs/ProgrammingGuide/text-matching.md">Edit on Fork on GitHub </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#build-a-knrm-model">Build a KNRM Model</a></li>
        <li class="main "><a href="#pairwise-training">Pairwise training</a></li>
        <li class="main "><a href="#listwise-evaluation">Listwise evaluation</a></li>
        <li class="main "><a href="#examples">Examples</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Analytics Zoo provides a pre-defined KNRM model that can be used for text matching (e.g. question answering).
More text matching models will be supported in the future.</p>
<p><strong>Highlights</strong></p>
<ol>
<li>Easy-to-use Keras-Style defined model which provides compile and fit methods for training. Alternatively, it could be fed into NNFrames or BigDL Optimizer.</li>
<li>The model can be used for both ranking and classification tasks.</li>
</ol>
<hr />
<h2 id="build-a-knrm-model"><strong>Build a KNRM Model</strong></h2>
<p>Kernel-pooling Neural Ranking Model with RBF kernel. See <a href="https://arxiv.org/abs/1706.06613">here</a> for more details.</p>
<p>You can call the following API in Scala and Python respectively to create a <code>KNRM</code> with <em>pre-trained GloVe word embeddings</em>.</p>
<p><strong>Scala</strong></p>
<pre><code class="scala">val knrm = KNRM(text1Length, text2Length, embeddingFile, wordIndex = null, trainEmbed = true, kernelNum = 21, sigma = 0.1, exactSigma = 0.001, targetMode = &quot;ranking&quot;)
</code></pre>

<ul>
<li><code>text1Length</code>: Sequence length of text1 (query).</li>
<li><code>text2Length</code>: Sequence length of text2 (doc).</li>
<li><code>embeddingFile</code>: The path to the word embedding file. Currently only <em>glove.6B.50d.txt, glove.6B.100d.txt, glove.6B.200d.txt, glove.6B.300d.txt, glove.42B.300d.txt, glove.840B.300d.txt</em> are supported. You can download from <a href="https://nlp.stanford.edu/projects/glove/">here</a>.</li>
<li><code>wordIndex</code>: Map of word (String) and its corresponding index (integer). The index is supposed to <strong>start from 1</strong> with 0 reserved for unknown words. During the prediction, if you have words that are not in the wordIndex for the training, you can map them to index 0. Default is null. In this case, all the words in the embeddingFile will be taken into account and you can call <code>WordEmbedding.getWordIndex(embeddingFile)</code> to retrieve the map.</li>
<li><code>trainEmbed</code>: Boolean. Whether to train the embedding layer or not. Default is true.</li>
<li><code>kernelNum</code>: Integer &gt; 1. The number of kernels to use. Default is 21.</li>
<li><code>sigma</code>: Double. Defines the kernel width, or the range of its softTF count. Default is 0.1.</li>
<li><code>exactSigma</code>: Double. The sigma used for the kernel that harvests exact matches in the case where RBF mu=1.0. Default is 0.001.</li>
<li><code>targetMode</code>: String. The target mode of the model. Either 'ranking' or 'classification'. For ranking, the output will be the relevance score between text1 and text2 and you are recommended to use 'rank_hinge' as loss for pairwise training.
For classification, the last layer will be sigmoid and the output will be the probability between 0 and 1 indicating whether text1 is related to text2 and
you are recommended to use 'binary_crossentropy' as loss for binary classification. Default mode is 'ranking'.</li>
</ul>
<p><strong>Python</strong></p>
<pre><code class="python">knrm = KNRM(text1_length, text2_length, embedding_file, word_index=None, train_embed=True, kernel_num=21, sigma=0.1, exact_sigma=0.001, target_mode=&quot;ranking&quot;)
</code></pre>

<ul>
<li><code>text1_length</code>: Sequence length of text1 (query).</li>
<li><code>text2_length</code>: Sequence length of text2 (doc).</li>
<li><code>embedding_file</code>: The path to the word embedding file. Currently only <em>glove.6B.50d.txt, glove.6B.100d.txt, glove.6B.200d.txt, glove.6B.300d.txt, glove.42B.300d.txt, glove.840B.300d.txt</em> are supported. You can download from <a href="https://nlp.stanford.edu/projects/glove/">here</a>.</li>
<li><code>word_index</code>: Dictionary of word (string) and its corresponding index (int). The index is supposed to <strong>start from 1</strong> with 0 reserved for unknown words. During the prediction, if you have words that are not in the wordIndex for the training, you can map them to index 0. Default is None. In this case, all the words in the embedding_file will be taken into account and you can call <code>WordEmbedding.get_word_index(embedding_file)</code> to retrieve the dictionary.</li>
<li><code>train_embed</code>: Boolean. Whether to train the embedding layer or not. Default is True.</li>
<li><code>kernel_num</code>: Int &gt; 1. The number of kernels to use. Default is 21.</li>
<li><code>sigma</code>: Float. Defines the kernel width, or the range of its softTF count. Default is 0.1.</li>
<li><code>exact_sigma</code>: Float. The sigma used for the kernel that harvests exact matches in the case where RBF mu=1.0. Default is 0.001.</li>
<li><code>target_mode</code>: String. The target mode of the model. Either 'ranking' or 'classification'. For ranking, the output will be the relevance score between text1 and text2 and you are recommended to use 'rank_hinge' as loss for pairwise training.
For classification, the last layer will be sigmoid and the output will be the probability between 0 and 1 indicating whether text1 is related to text2 and
you are recommended to use 'binary_crossentropy' as loss for binary classification. Default mode is 'ranking'.</li>
</ul>
<hr />
<h2 id="pairwise-training"><strong>Pairwise training</strong></h2>
<p>For ranking, the model can be trained pairwisely with the following steps:</p>
<ol>
<li>Read train relations. See <a href="../APIGuide/FeatureEngineering/relation/#read-relations">here</a> for more details.</li>
<li>Read text1 and text2 corpus as TextSet. See <a href="../APIGuide/FeatureEngineering/text/#read-texts-from-csv-file">here</a> for more details.</li>
<li>Preprocess text1 and text2 corpus. See <a href="../APIGuide/FeatureEngineering/text/#textset-transformations">here</a> for more details.</li>
<li>Generate all relation pairs from train relations. Each pair is made up of a positive relation and a negative one of the same id1.
During the training process, we intend to optimize the margin loss within each pair.
We provide the following API to generate a <code>TextSet</code> for pairwise training:</li>
</ol>
<p><strong>Scala</strong></p>
<pre><code class="scala">val trainSet = TextSet.fromRelationPairs(relations, corpus1, corpus2)
</code></pre>

<ul>
<li><code>relations</code>: RDD or array of Relation.</li>
<li><code>corpus1</code>: TextSet that contains all id1 in relations.</li>
<li><code>corpus2</code>: TextSet that contains all id2 in relations.</li>
<li>For corpus1 and corpus2 respectively, each text must have been transformed to indices of the same length by
  calling <a href="../APIGuide/FeatureEngineering/text/#tokenization">tokenize</a>, <a href="../APIGuide/FeatureEngineering/text/#word-to-index">word2idx</a> 
  and <a href="../APIGuide/FeatureEngineering/text/#sequence-shaping">shapeSequence</a> in order.</li>
<li>If relations is an RDD, then corpus1 and corpus2 must both be DistributedTextSet.
If relations is an array, then corpus1 and corpus2 must both be LocalTextSet.</li>
</ul>
<p><strong>Python</strong></p>
<pre><code class="python">train_set = TextSet.from_relation_pairs(relations, corpus1, corpus2)
</code></pre>

<ul>
<li><code>relations</code>: RDD or list of Relation.</li>
<li><code>corpus1</code>: TextSet that contains all id1 in relations.</li>
<li><code>corpus2</code>: TextSet that contains all id2 in relations.</li>
<li>For corpus1 and corpus2 respectively, each text must have been transformed to indices of the same length by
  calling <a href="../APIGuide/FeatureEngineering/text/#tokenization">tokenize</a>, <a href="../APIGuide/FeatureEngineering/text/#word-to-index">word2idx</a> 
  and <a href="../APIGuide/FeatureEngineering/text/#sequence-shaping">shape_sequence</a> in order.</li>
<li>If relations is an RDD, then corpus1 and corpus2 must both be DistributedTextSet.
If relations is a list, then corpus1 and corpus2 must both be LocalTextSet.</li>
</ul>
<p>Call compile and fit to train the model:</p>
<p><strong>Scala</strong></p>
<pre><code class="scala">val model = Sequential().add(TimeDistributed(knrm, inputShape = Shape(2, text1Length + text2Length)))
model.compile(optimizer = new SGD(learningRate), loss = RankHinge())
model.fit(trainSet, batchSize, nbEpoch)
</code></pre>

<p><strong>Python</strong></p>
<pre><code class="python">model = Sequential().add(TimeDistributed(knrm, input_shape=(2, text1Length + text2Length)))
model.compile(optimizer=SGD(learning_rate), loss='rank_hinge')
model.fit(train_set, batch_size, nb_epoch)
</code></pre>

<hr />
<h2 id="listwise-evaluation"><strong>Listwise evaluation</strong></h2>
<p>Given text1 and a list of text2 candidates, we provide metrics <a href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Discounted_cumulative_gain">NDCG</a> and <a href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision">MAP</a> to listwisely evaluate a ranking model with the following steps:</p>
<ol>
<li>Read validation relations. See <a href="../APIGuide/FeatureEngineering/relation/#read-relations">here</a> for more details.</li>
<li>Read text1 and text2 corpus as TextSet. See <a href="../APIGuide/FeatureEngineering/text/#read-texts-from-csv-file">here</a> for more details.</li>
<li>Preprocess text1 and text2 corpus same as the training phase. See <a href="../APIGuide/FeatureEngineering/text/#textset-transformations">here</a> for more details.</li>
<li>Generate all relation lists from validation relations. Each list is made up of one id1 and all id2 combined with id1.
We provide the following API to generate a <code>TextSet</code> for listwise evaluation:</li>
</ol>
<p><strong>Scala</strong></p>
<pre><code class="scala">val validateSet = TextSet.fromRelationLists(relations, corpus1, corpus2)
</code></pre>

<ul>
<li><code>relations</code>: RDD or array of Relation.</li>
<li><code>corpus1</code>: TextSet that contains all id1 in relations.</li>
<li><code>corpus2</code>: TextSet that contains all id2 in relations.</li>
<li>For corpus1 and corpus2 respectively, each text must have been transformed to indices of the same length as during the training process by 
calling <a href="../APIGuide/FeatureEngineering/text/#tokenization">tokenize</a>, <a href="../APIGuide/FeatureEngineering/text/#word-to-index">word2idx</a> 
and <a href="../APIGuide/FeatureEngineering/text/#sequence-shaping">shapeSequence</a> in order.</li>
<li>If relations is an RDD, then corpus1 and corpus2 must both be DistributedTextSet.
If relations is an array, then corpus1 and corpus2 must both be LocalTextSet.</li>
</ul>
<p><strong>Python</strong></p>
<pre><code class="python">validate_set = TextSet.from_relation_lists(relations, corpus1, corpus2)
</code></pre>

<ul>
<li><code>relations</code>: RDD or list of Relation.</li>
<li><code>corpus1</code>: TextSet that contains all id1 in relations.</li>
<li><code>corpus2</code>: TextSet that contains all id2 in relations.</li>
<li>For corpus1 and corpus2 respectively, each text must have been transformed to indices of the same length as during the training process by 
calling <a href="../APIGuide/FeatureEngineering/text/#tokenization">tokenize</a>, <a href="../APIGuide/FeatureEngineering/text/#word-to-index">word2idx</a> 
and <a href="../APIGuide/FeatureEngineering/text/#sequence-shaping">shape_sequence</a> in order.</li>
<li>If relations is an RDD, then corpus1 and corpus2 must both be DistributedTextSet.
If relations is a list, then corpus1 and corpus2 must both be LocalTextSet.</li>
</ul>
<p>Call evaluateNDCG or evaluateMAP to evaluate the model:</p>
<p><strong>Scala</strong></p>
<pre><code class="scala">knrm.evaluateNDCG(validateSet, k, threshold = 0.0)
knrm.evaluateMAP(validateSet, threshold = 0.0)
</code></pre>

<p><strong>Python</strong></p>
<pre><code class="python">knrm.evaluate_ndcg(validate_set, k, threshold=0.0)
knrm.evaluate_map(validate_set, threshold=0.0)
</code></pre>

<ul>
<li><code>k</code>: Positive integer. Rank position in NDCG.</li>
<li><code>threshold</code>: If label &gt; threshold, then it will be considered as a positive record. Default is 0.0.</li>
</ul>
<hr />
<h2 id="examples"><strong>Examples</strong></h2>
<p>We provide an example to train and evaluate a KNRM model on WikiQA dataset for ranking.</p>
<p>See <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/zoo/src/main/scala/com/intel/analytics/zoo/examples/qaranker">here</a> for the Scala example.</p>
<p>See <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/pyzoo/zoo/examples/qaranker">here</a> for the Python example.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
