
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>zoo.pipeline.api.autograd &#8212; analytics-zoo  documentation</title>
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">analytics-zoo  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for zoo.pipeline.api.autograd</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright 2018 Analytics Zoo Authors.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">bigdl.nn.layer</span> <span class="kn">import</span> <span class="n">Layer</span><span class="p">,</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">bigdl.util.common</span> <span class="kn">import</span> <span class="n">to_list</span><span class="p">,</span> <span class="n">JTensor</span>

<span class="kn">from</span> <span class="nn">zoo.common.utils</span> <span class="kn">import</span> <span class="n">callZooFunc</span>
<span class="kn">import</span> <span class="nn">zoo.pipeline.api.keras.base</span> <span class="k">as</span> <span class="nn">kbase</span>
<span class="kn">from</span> <span class="nn">zoo.pipeline.api.keras.objectives</span> <span class="kn">import</span> <span class="n">LossFunction</span>
<span class="kn">from</span> <span class="nn">zoo.pipeline.api.utils</span> <span class="kn">import</span> <span class="n">remove_batch</span><span class="p">,</span> <span class="n">toMultiShape</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>


<div class="viewcode-block" id="mean"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.mean">[docs]</a><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepDims</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean of a variable, alongside the specified axis.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :param axis: A list of integer. Axes to compute the mean.</span>
<span class="sd">    :param keepDims: A boolean, whether to keep the dimensions or not.</span>
<span class="sd">            If `keepDims` is `False`, the rank of the variable is reduced</span>
<span class="sd">            by 1 for each entry in `axis`. If `keepDims` is `True`,</span>
<span class="sd">            the reduced dimensions are retained with length 1.</span>
<span class="sd">    :return: A variable with the mean of elements of `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">keepDims</span><span class="p">))</span></div>


<div class="viewcode-block" id="abs"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.abs">[docs]</a><span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise absolute value.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;abs&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="batch_dot"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.batch_dot">[docs]</a><span class="k">def</span> <span class="nf">batch_dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operator that computes a dot product between samples in two tensors.</span>

<span class="sd">    E.g. if applied to two tensors `a` and `b` of shape `(batch_size, n)`,</span>
<span class="sd">    the output will be a tensor of shape `(batch_size, 1)`</span>
<span class="sd">    where each entry `i` will be the dot product between</span>
<span class="sd">    `a[i]` and `b[i]`.</span>

<span class="sd">    :param x: Shape should only be [batch, xx]</span>
<span class="sd">    :param y: Shape should only be [batch, xx]</span>
<span class="sd">    :param axes: Integer or tuple of integers,</span>
<span class="sd">                axis or axes along which to take the dot product.</span>
<span class="sd">    :param normalize: Whether to L2-normalize samples along the</span>
<span class="sd">                dot product axis before taking the dot product.</span>
<span class="sd">                If set to True, then the output of the dot product</span>
<span class="sd">                is the cosine proximity between the two samples.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;batchDot&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">normalize</span><span class="p">))</span></div>


<div class="viewcode-block" id="l2_normalize"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.l2_normalize">[docs]</a><span class="k">def</span> <span class="nf">l2_normalize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes a tensor wrt the L2 norm alongside the specified axis.</span>
<span class="sd">    :param x: A variable. Shape should only be [batch, xx]</span>
<span class="sd">    :param axis: axis along which to perform normalization.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;l2Normalize&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">axis</span><span class="p">)))</span></div>


<div class="viewcode-block" id="sum"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.sum">[docs]</a><span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepDims</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sum of the values in a a variable, alongside the specified axis.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :param axis: An integer. Axes to compute the sum over.</span>
<span class="sd">    :param keepDims: A boolean, whether to keep the dimensions or not.</span>
<span class="sd">            If `keepDims` is `False`, the rank of the variable is reduced</span>
<span class="sd">            by 1 for each entry in `axis`. If `keepDims` is `True`,</span>
<span class="sd">            the reduced dimensions are retained with length 1.</span>
<span class="sd">    :return: A variable with sum of `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">keepDims</span><span class="p">))</span></div>


<div class="viewcode-block" id="stack"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.stack">[docs]</a><span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stacks a list of rank `R` tensors into a rank `R+1` tensor.</span>
<span class="sd">    You should start from 1 as dim 0 is for batch.</span>
<span class="sd">    :param inputs: List of variables (tensors).</span>
<span class="sd">    :param axis: axis along which to perform stacking.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span></div>


<div class="viewcode-block" id="expand_dims"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.expand_dims">[docs]</a><span class="k">def</span> <span class="nf">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Adds a 1-sized dimension at index &quot;axis&quot;.</span>
<span class="sd">    :param x: a Variable to be expanded</span>
<span class="sd">    :param axis: axis Position where to add a new axis.</span>
<span class="sd">    The axis is 0 based and if you set the axis to 0, you would change the batch dim.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;expandDims&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span></div>


<div class="viewcode-block" id="clip"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.clip">[docs]</a><span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise value clipping.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :param min: Python float or integer.</span>
<span class="sd">    :param max: Python float or integer.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;clip&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="nb">min</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">)))</span></div>


<div class="viewcode-block" id="contiguous"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.contiguous">[docs]</a><span class="k">def</span> <span class="nf">contiguous</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Turn the output and grad to be contiguous for the input Variable</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;contiguous&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="square"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.square">[docs]</a><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise square.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="sqrt"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.sqrt">[docs]</a><span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise square root.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="exp"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.exp">[docs]</a><span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise exponential.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="maximum"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.maximum">[docs]</a><span class="k">def</span> <span class="nf">maximum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise maximum of two variables.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :param y: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span></div>


<div class="viewcode-block" id="log"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.log">[docs]</a><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise log.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="pow"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.pow">[docs]</a><span class="k">def</span> <span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Element-wise exponentiation.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :param a: Python integer.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;pow&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span></div>


<div class="viewcode-block" id="epsilon"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.epsilon">[docs]</a><span class="k">def</span> <span class="nf">epsilon</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the value of epsilon.</span>
<span class="sd">    :return: A value of type Double.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;epsilon&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="neg"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.neg">[docs]</a><span class="k">def</span> <span class="nf">neg</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes numerical negative value element-wise.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;neg&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="softsign"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.softsign">[docs]</a><span class="k">def</span> <span class="nf">softsign</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Softsign of a variable.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;softsign&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="softplus"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.softplus">[docs]</a><span class="k">def</span> <span class="nf">softplus</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Softplus of a variable.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;softplus&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="mm"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.mm">[docs]</a><span class="k">def</span> <span class="nf">mm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Module to perform matrix multiplication on two mini-batch inputs,</span>
<span class="sd">    producing a mini-batch.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :param y: A variable.</span>
<span class="sd">    :param axes: Axes along which to perform multiplication.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">))</span></div>


<div class="viewcode-block" id="erf"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.erf">[docs]</a><span class="k">def</span> <span class="nf">erf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the error function(Gauss error function) of each element.</span>
<span class="sd">    :param x: A variable.</span>
<span class="sd">    :return: A variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;erf&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="VariableOperator"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator">[docs]</a><span class="k">class</span> <span class="nc">VariableOperator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># TODO: we need to add a mapping for Shape here.</span>
    <span class="k">def</span> <span class="nf">__to_batch_shape</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">def</span> <span class="nf">__process_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__to_batch_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__to_batch_shape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]</span>

<div class="viewcode-block" id="VariableOperator.get_input_shape"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.get_input_shape">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_shape</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;varGetInputShape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span></div>

<div class="viewcode-block" id="VariableOperator.get_output_shape"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.get_output_shape">[docs]</a>    <span class="k">def</span> <span class="nf">get_output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_shape</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;varGetOutputShape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_shape</span><span class="p">()</span>

<div class="viewcode-block" id="VariableOperator.from_jvalue"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.from_jvalue">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_jvalue</span><span class="p">(</span><span class="n">jvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">jvalue</span><span class="o">=</span><span class="n">jvalue</span><span class="p">)</span></div>

<div class="viewcode-block" id="VariableOperator.add"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span></div>
        <span class="c1"># self.value.getClass().getSimpleName()</span>

<div class="viewcode-block" id="VariableOperator.sub"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.sub">[docs]</a>    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="fm">__radd__</span> <span class="o">=</span> <span class="fm">__add__</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;mul&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="fm">__truediv__</span> <span class="o">=</span> <span class="n">__div__</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="fm">__rtruediv__</span> <span class="o">=</span> <span class="n">__rdiv__</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">neg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="VariableOperator.slice"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.slice">[docs]</a>    <span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as narrow in Torch.</span>
<span class="sd">        Slice the input with the number of dimensions not being reduced.</span>
<span class="sd">        The batch dimension needs to be unchanged.</span>
<span class="sd">        For example, if input is:</span>
<span class="sd">        1 2 3</span>
<span class="sd">        4 5 6</span>
<span class="sd">        slice(1, 1, 2) will give output</span>
<span class="sd">        2 3</span>
<span class="sd">        5 6</span>
<span class="sd">        slice(1, 2, -1) will give output</span>
<span class="sd">        3</span>
<span class="sd">        6</span>
<span class="sd">        :param  dim The dimension to narrow. 0-based index. Cannot narrow the batch dimension.</span>
<span class="sd">                -1 means the last dimension of the input.</span>
<span class="sd">        :param  startIndex Non-negative integer.</span>
<span class="sd">                The start index on the given dimension. 0-based index.</span>
<span class="sd">        :param length The length to be sliced. Default is 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span>
            <span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;slice&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span></div>

<div class="viewcode-block" id="VariableOperator.index_select"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.index_select">[docs]</a>    <span class="k">def</span> <span class="nf">index_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Select an index of the input in the given dim and return the subset part.</span>
<span class="sd">           The batch dimension needs to be unchanged.</span>
<span class="sd">           The selected dim would be remove after this operation.</span>
<span class="sd">           For example, if input is:</span>
<span class="sd">           1 2 3</span>
<span class="sd">           4 5 6</span>
<span class="sd">           Select(1, 1) will give output [2 5]</span>
<span class="sd">           Select(1, -1) will give output [3 6]</span>
<span class="sd">        :param dim: The dimension to select. 0-based index. Cannot select the batch dimension.</span>
<span class="sd">                -1 means the last dimension of the input.</span>
<span class="sd">        :param index: The index of the dimension to be selected. 0-based index.</span>
<span class="sd">               -1 means the last dimension of the input.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;indexSelect&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span></div>

<div class="viewcode-block" id="VariableOperator.squeeze"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.VariableOperator.squeeze">[docs]</a>    <span class="k">def</span> <span class="nf">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the singleton dimension(s).</span>
<span class="sd">        The dim can be zero, and if so you would change the batch dim.</span>
<span class="sd">        For example, if input has size (2, 1, 3, 4, 1):</span>
<span class="sd">        Squeeze(dim = 1) will give output size (2, 3, 4, 1)</span>
<span class="sd">        Squeeze(dims = null) will give output size (2, 3, 4)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;squeeze&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="Variable"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Variable">[docs]</a><span class="k">class</span> <span class="nc">Variable</span><span class="p">(</span><span class="n">kbase</span><span class="o">.</span><span class="n">ZooKerasCreator</span><span class="p">,</span> <span class="n">VariableOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">jvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">jvalue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">jvalue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bigdl_type</span> <span class="o">=</span> <span class="s2">&quot;float&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">Variable</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jvalue</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">Variable</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jvalue</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">toMultiShape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Variable.set_name"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Variable.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">element</span><span class="p">()</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Variable.from_node"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Variable.from_node">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_node</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Node</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">node</span><span class="p">())</span></div>


<div class="viewcode-block" id="Lambda"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Lambda">[docs]</a><span class="k">class</span> <span class="nc">Lambda</span><span class="p">(</span><span class="n">kbase</span><span class="o">.</span><span class="n">ZooKerasCreator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used for evaluating an arbitrary expressions on an input.</span>

<span class="sd">       # Examples</span>

<span class="sd">       ```python</span>
<span class="sd">           # add a x -&gt; x + 2 layer</span>
<span class="sd">           model.add(Lambda(lambda x: x + 2))</span>
<span class="sd">       ```</span>
<span class="sd">       # Arguments</span>
<span class="sd">           function: The function to be evaluated.</span>
<span class="sd">               Takes input tensor as first argument.</span>

<span class="sd">       # Input shape</span>
<span class="sd">           Arbitrary. Use the keyword argument input_shape</span>
<span class="sd">           (tuple of integers, does not include the samples axis)</span>
<span class="sd">           when using this layer as the first layer in a model.</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bigdl_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">input_shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bigdl_type</span> <span class="o">=</span> <span class="n">bigdl_type</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Some other modules point to current module</span>
<span class="sd">        :param x: upstream module nodes. x is either a Node or list of Node.</span>
<span class="sd">        :return: node containing current module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">to_list</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">):</span>
            <span class="n">input_shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">get_output_shape</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">remove_batch</span><span class="p">(</span><span class="n">input_shapes</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="o">.</span><span class="n">from_jvalue</span><span class="p">(</span><span class="n">callZooFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bigdl_type</span><span class="p">,</span>
                                                <span class="s2">&quot;connectInputs&quot;</span><span class="p">,</span>
                                                <span class="n">layer</span><span class="p">,</span>
                                                <span class="n">to_list</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="c1"># input_shapes should not contain batch dim</span>
<div class="viewcode-block" id="Lambda.create"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Lambda.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shapes</span><span class="p">):</span>
        <span class="n">input_shapes</span> <span class="o">=</span> <span class="n">toMultiShape</span><span class="p">(</span><span class="n">input_shapes</span><span class="p">)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Variable</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">output_shape</span><span class="p">))</span> <span class="k">for</span> <span class="n">output_shape</span> <span class="ow">in</span> <span class="n">input_shapes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">LambdaLayer</span><span class="p">(</span><span class="n">input_vars</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
                           <span class="n">out_var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">),</span>
                           <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shapes</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LambdaLayer"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.LambdaLayer">[docs]</a><span class="k">class</span> <span class="nc">LambdaLayer</span><span class="p">(</span><span class="n">kbase</span><span class="o">.</span><span class="n">ZooKerasLayer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vars</span><span class="p">,</span> <span class="n">out_var</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LambdaLayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                          <span class="n">input_vars</span><span class="p">,</span>
                                          <span class="n">out_var</span><span class="p">,</span>
                                          <span class="nb">list</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span> <span class="k">if</span> <span class="n">input_shape</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="n">kbase</span><span class="o">.</span><span class="n">ZooKerasLayer</span><span class="p">,</span> <span class="n">VariableOperator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A trainable Variable. The default init_method is RandomUniform(-0.05, 0.05).</span>
<span class="sd">    You can also specify the init_weight by passing a ndarray.</span>
<span class="sd">    :param shape: Shape of this Parameter</span>
<span class="sd">    :param init_method: A method used to initialize the Parameter.</span>
<span class="sd">                        The default value is RandomUniform(-0.05, 0.05)</span>
<span class="sd">    :param init_weight: A ndarray as the init value.</span>
<span class="sd">    :param trainable It&#39;s true by default, meaning the value would be updated by gradient.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">init_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">init_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">init_method</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">bigdl.nn.initialization_method</span> <span class="kn">import</span> <span class="n">RandomUniform</span>
            <span class="n">init_method</span> <span class="o">=</span> <span class="n">RandomUniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
                                        <span class="n">init_method</span><span class="p">,</span>
                                        <span class="n">kbase</span><span class="o">.</span><span class="n">JTensor</span><span class="o">.</span><span class="n">from_ndarray</span><span class="p">(</span><span class="n">init_weight</span><span class="p">),</span>
                                        <span class="n">trainable</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_weight</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>

<div class="viewcode-block" id="Parameter.get_weight"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Parameter.get_weight">[docs]</a>    <span class="k">def</span> <span class="nf">get_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the ndarray for the current weight</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">jtensor</span> <span class="o">=</span> <span class="n">callZooFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bigdl_type</span><span class="p">,</span>
                              <span class="s2">&quot;getParameterWeight&quot;</span><span class="p">,</span>
                              <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jtensor</span><span class="o">.</span><span class="n">to_ndarray</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parameter.set_weight"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Parameter.set_weight">[docs]</a>    <span class="k">def</span> <span class="nf">set_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param value: value is a ndarray</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">callZooFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bigdl_type</span><span class="p">,</span>
                    <span class="s2">&quot;setParameterWeight&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">kbase</span><span class="o">.</span><span class="n">JTensor</span><span class="o">.</span><span class="n">from_ndarray</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="Constant"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.Constant">[docs]</a><span class="k">class</span> <span class="nc">Constant</span><span class="p">(</span><span class="n">kbase</span><span class="o">.</span><span class="n">ZooKerasCreator</span><span class="p">,</span> <span class="n">VariableOperator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A constant Variable without weights.</span>
<span class="sd">    :param data: value of the Variable.</span>
<span class="sd">    :param name: Optional. Name of the Variable</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bigdl_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Constant</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">bigdl_type</span><span class="p">,</span> <span class="n">JTensor</span><span class="o">.</span><span class="n">from_ndarray</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomLoss"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.CustomLoss">[docs]</a><span class="k">class</span> <span class="nc">CustomLoss</span><span class="p">(</span><span class="n">LossFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">y_pred_shape</span><span class="p">,</span> <span class="n">y_true_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param loss_func: a function which accept y_true and y_pred</span>
<span class="sd">        :param y_pred_shape: The pred shape without batch dim.</span>
<span class="sd">        :param y_true_shape: The target shape without batch dim.</span>
<span class="sd">               It should be the same as y_pred_shape by default.</span>
<span class="sd">        i.e input_shape=[3], then the feeding data would be [None, 3]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y_real</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="n">y_true_shape</span> <span class="k">if</span> <span class="n">y_true_shape</span> <span class="k">else</span> <span class="n">y_pred_shape</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="n">y_pred_shape</span><span class="p">)</span>
        <span class="n">loss_var</span> <span class="o">=</span> <span class="n">loss_func</span><span class="p">(</span><span class="n">y_real</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CustomLoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">y_real</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">],</span> <span class="n">loss_var</span><span class="p">)</span>

<div class="viewcode-block" id="CustomLoss.forward"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.CustomLoss.forward">[docs]</a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NB: It&#39;s for debug only, please use optimizer.optimize() in production.</span>
<span class="sd">        Takes an input object, and computes the corresponding loss of the criterion,</span>
<span class="sd">        compared with `target`</span>

<span class="sd">        :param input: ndarray or list of ndarray</span>
<span class="sd">        :param target: ndarray or list of ndarray</span>
<span class="sd">        :return: value of loss</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="n">y_pred</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">y_true</span>
        <span class="n">jinput</span><span class="p">,</span> <span class="n">input_is_table</span> <span class="o">=</span> <span class="n">Layer</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="n">jtarget</span><span class="p">,</span> <span class="n">target_is_table</span> <span class="o">=</span> <span class="n">Layer</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">callZooFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bigdl_type</span><span class="p">,</span>
                             <span class="s2">&quot;criterionForward&quot;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                             <span class="n">jinput</span><span class="p">,</span>
                             <span class="n">input_is_table</span><span class="p">,</span>
                             <span class="n">jtarget</span><span class="p">,</span>
                             <span class="n">target_is_table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="CustomLoss.backward"><a class="viewcode-back" href="../../../../zoo.pipeline.api.html#zoo.pipeline.api.autograd.CustomLoss.backward">[docs]</a>    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NB: It&#39;s for debug only, please use optimizer.optimize() in production.</span>
<span class="sd">        Performs a back-propagation step through the criterion, with respect to the given input.</span>

<span class="sd">        :param input: ndarray or list of ndarray</span>
<span class="sd">        :param target: ndarray or list of ndarray</span>
<span class="sd">        :return: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="n">y_pred</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">y_true</span>
        <span class="n">jinput</span><span class="p">,</span> <span class="n">input_is_table</span> <span class="o">=</span> <span class="n">Layer</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="n">jtarget</span><span class="p">,</span> <span class="n">target_is_table</span> <span class="o">=</span> <span class="n">Layer</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">callZooFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bigdl_type</span><span class="p">,</span>
                             <span class="s2">&quot;criterionBackward&quot;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                             <span class="n">jinput</span><span class="p">,</span>
                             <span class="n">input_is_table</span><span class="p">,</span>
                             <span class="n">jtarget</span><span class="p">,</span>
                             <span class="n">target_is_table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Layer</span><span class="o">.</span><span class="n">convert_output</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">analytics-zoo  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Intel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>