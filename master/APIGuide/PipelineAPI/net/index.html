<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Net - Analytics Zoo</title>
    <link href="/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/highlight.css">
    <link href="../../../extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/bootstrap-3.3.7.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Net", url: "#net", children: [
              {title: "Load Analytics Zoo Model", url: "#load-analytics-zoo-model" },
              {title: "Load BigDL Model", url: "#load-bigdl-model" },
              {title: "Load Torch Model", url: "#load-torch-model" },
              {title: "Load Caffe Model", url: "#load-caffe-model" },
              {title: "Load Tensorflow model", url: "#load-tensorflow-model" },
          ]},
          {title: "TFNet", url: "#tfnet", children: [
          ]},
        ];

    </script>
    <script src="/js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    
    <h1><strong>Net</strong></h1>
    <hr>
    <h2 id="net">Net</h2>
<h3 id="load-analytics-zoo-model">Load Analytics Zoo Model</h3>
<p>Use <code>Net.load</code>(in Scala) or <code>Net.load</code> (in Python) to load an existing model defined using the Analytics Zoo Keras-style API.  <code>Net</code> (Scala) or <code>Net</code>(Python) is a utility class provided in Analytics Zoo. We just need to specify the model path and optionally weight path if exists where we previously saved the model to load it to memory for resume training or prediction purpose.</p>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.load(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
val model = Net.load(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.load(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.load(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
model = Net.load(&quot;hdfs://...&quot;) //load from hdfs
model = Net.load(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-bigdl-model">Load BigDL Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadBigDL(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
val model = Net.loadBigDL(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.loadBigDL(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadBigDL(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
model = Net.loadBigDL(&quot;hdfs://...&quot;) //load from hdfs
model = Net.loadBigDL(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-torch-model">Load Torch Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadTorch(&quot;/tmp/torch_model&quot;) //load from local fs
val model = Net.loadTorch(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.loadTorch(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadTorch(&quot;/tmp/torch_model&quot;) //load from local fs
model = Net.loadTorch(&quot;hdfs://...&quot;) //load from hdfs
model = Net.loadTorch(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-caffe-model">Load Caffe Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadCaffe(&quot;/tmp/def/path&quot;, &quot;/tmp/model/path&quot;) //load from local fs
val model = Net.loadCaffe(&quot;hdfs://def/path&quot;, &quot;hdfs://model/path&quot;) //load from hdfs
val model = Net.loadCaffe(&quot;s3://def/path&quot;, &quot;s3://model/path&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadCaffe(&quot;/tmp/def/path&quot;, &quot;/tmp/model/path&quot;) //load from local fs
model = Net.loadCaffe(&quot;hdfs://def/path&quot;, &quot;hdfs://model/path&quot;) //load from hdfs
model = Net.loadCaffe(&quot;s3://def/path&quot;, &quot;s3://model/path&quot;) //load from s3
</code></pre>

<h3 id="load-tensorflow-model">Load Tensorflow model</h3>
<p>We also provides utilities to load tensorflow model.
for more information.</p>
<p>If we already have a freezed graph protobuf file, we can use the <code>loadTF</code> api directly to
load the tensorflow model. </p>
<p>Otherwise, we should first use the <code>export_tf_checkpoint.py</code> script provided by BigDL's distribution
package, or the <code>dump_model</code> function defined in <a href="https://github.com/intel-analytics/BigDL/blob/master/pyspark/bigdl/util/tf_utils.py">here</a> to
generate the model definition file (<code>model.pb</code>) and variable binary file (<code>model.bin</code>). </p>
<p><strong>Use Script</strong></p>
<pre><code class="shell">GRAPH_META_FILE=/tmp/tensorflow/model.ckpt.meta
CKPT_FILE_PREFIX=/tmp/tensorflow/model.ckpt
SAVE_PATH=/tmp/model/
python export_tf_checkpoint.py $GRAPH_META_FILE $CKPT_FILE_PREFIX $SAVE_PATH
</code></pre>

<p><strong>Use python function</strong></p>
<pre><code class="python">import tensorflow as tf

# This is your model definition.
xs = tf.placeholder(tf.float32, [None, 1])

W1 = tf.Variable(tf.zeros([1,10])+0.2)
b1 = tf.Variable(tf.zeros([10])+0.1)
Wx_plus_b1 = tf.nn.bias_add(tf.matmul(xs,W1), b1)
output = tf.nn.tanh(Wx_plus_b1, name=&quot;output&quot;)

# Adding the following lines right after your model definition 
from bigdl.util.tf_utils import dump_model
dump_model_path = &quot;/tmp/model&quot;
# This line of code will create a Session and initialized all the Variable and
# save the model definition and variable to dump_model_path as BigDL readable format.
dump_model(path=dump_model_path)
</code></pre>

<p>Then we can use the <code>loadTF</code> api to load the tensorflow model into BigDL.</p>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val modelPath = &quot;/tmp/model/model.pb&quot;
val binPath = &quot;/tmp/model/model.bin&quot;
val inputs = Seq(&quot;Placeholder&quot;)
val outputs = Seq(&quot;output&quot;)

// For tensorflow freezed graph or graph without Variables
val model = Net.loadTF(modelPath, inputs, outputs, ByteOrder.LITTLE_ENDIAN)

// For tensorflow graph with Variables
val model = Net.loadTF(modelPath, inputs, outputs, ByteOrder.LITTLE_ENDIAN, Some(binPath))
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model_def = &quot;/tmp/model/model.pb&quot;
model_variable = &quot;/tmp/model/model.bin&quot;
inputs = [&quot;Placeholder&quot;]
outputs = [&quot;output&quot;]
# For tensorflow freezed graph or graph without Variables
model = Net.load_tensorflow(model_def, inputs, outputs, byte_order = &quot;little_endian&quot;, bigdl_type=&quot;float&quot;)

# For tensorflow graph with Variables
model = Net.load_tensorflow(model_def, inputs, outputs, byte_order = &quot;little_endian&quot;, bigdl_type=&quot;float&quot;, bin_file=model_variable)
</code></pre>

<h2 id="tfnet">TFNet</h2>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val m = TFNet(freezedModelPath, inputs, outputs)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">m = TFNet(freezed_model_path, inputs, outputs)
</code></pre>

<p>This is a layer that wraps a tensorflow freezed sub graph as a layer and run tensorflow in parallel.</p>

  <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>