<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Net - Analytics Zoo</title>
    <link href="/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/highlight.css">
    <link href="../../../extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/bootstrap-3.3.7.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Net", url: "#net", children: [
              {title: "Load Analytics Zoo Model", url: "#load-analytics-zoo-model" },
              {title: "Load BigDL Model", url: "#load-bigdl-model" },
              {title: "Load Torch Model", url: "#load-torch-model" },
              {title: "Load Caffe Model", url: "#load-caffe-model" },
          ]},
          {title: "TFNet", url: "#tfnet", children: [
              {title: "Export TensorFlow model to frozen inference graph", url: "#export-tensorflow-model-to-frozen-inference-graph" },
              {title: "Creating a TFNet", url: "#creating-a-tfnet" },
          ]},
        ];

    </script>
    <script src="/js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-125166209-1', 'analytics-zoo.github.io');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    
    <h1><strong>Net</strong></h1>
    <hr>
    <h2 id="net">Net</h2>
<h3 id="load-analytics-zoo-model">Load Analytics Zoo Model</h3>
<p>Use <code>Net.load</code>(in Scala) or <code>Net.load</code> (in Python) to load an existing model defined using the Analytics Zoo Keras-style API.  <code>Net</code> (Scala) or <code>Net</code>(Python) is a utility class provided in Analytics Zoo. We just need to specify the model path and optionally weight path if exists where we previously saved the model to load it to memory for resume training or prediction purpose.</p>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.load(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
val model = Net.load(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.load(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.load(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
model = Net.load(&quot;hdfs://...&quot;) //load from hdfs
model = Net.load(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-bigdl-model">Load BigDL Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadBigDL(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
val model = Net.loadBigDL(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.loadBigDL(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadBigDL(&quot;/tmp/model.def&quot;, &quot;/tmp/model.weights&quot;) //load from local fs
model = Net.loadBigDL(&quot;hdfs://...&quot;) //load from hdfs
model = Net.loadBigDL(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-torch-model">Load Torch Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadTorch(&quot;/tmp/torch_model&quot;) //load from local fs
val model = Net.loadTorch(&quot;hdfs://...&quot;) //load from hdfs
val model = Net.loadTorch(&quot;s3://...&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadTorch(&quot;/tmp/torch_model&quot;) //load from local fs
model = Net.loadTorch(&quot;hdfs://...&quot;) //load from hdfs
model = Net.loadTorch(&quot;s3://...&quot;) //load from s3
</code></pre>

<h3 id="load-caffe-model">Load Caffe Model</h3>
<p><strong>Scala example</strong></p>
<pre><code class="scala">val model = Net.loadCaffe(&quot;/tmp/def/path&quot;, &quot;/tmp/model/path&quot;) //load from local fs
val model = Net.loadCaffe(&quot;hdfs://def/path&quot;, &quot;hdfs://model/path&quot;) //load from hdfs
val model = Net.loadCaffe(&quot;s3://def/path&quot;, &quot;s3://model/path&quot;) //load from s3
</code></pre>

<p><strong>Python example</strong></p>
<pre><code class="python">model = Net.loadCaffe(&quot;/tmp/def/path&quot;, &quot;/tmp/model/path&quot;) //load from local fs
model = Net.loadCaffe(&quot;hdfs://def/path&quot;, &quot;hdfs://model/path&quot;) //load from hdfs
model = Net.loadCaffe(&quot;s3://def/path&quot;, &quot;s3://model/path&quot;) //load from s3
</code></pre>

<h2 id="tfnet">TFNet</h2>
<p>TFNet is a analytics-zoo layer that wraps a tensorflow frozen graph and can easily run in parallel.</p>
<p>TFNet cannot be trained, so it can only be used for inference or as a feature extractor for fine tuning a model.
When used as feature extractor, there should not be any trainable layers before TFNet, as all the gradient
from TFNet is set to zero.</p>
<p><strong>Remarks</strong>:</p>
<ul>
<li>You need to install <strong>tensorflow==1.10</strong> on your driver node.</li>
<li>Your operating system (OS) is required to be one of the following 64-bit systems:
<strong>Ubuntu 16.04 or later</strong> and <strong>macOS 10.12.6 or later</strong>.</li>
<li>To run on other systems, you need to manually compile the TensorFlow source code. Instructions can
  be found <a href="https://github.com/tensorflow/tensorflow/tree/v1.10.0/tensorflow/java">here</a>.</li>
</ul>
<h3 id="export-tensorflow-model-to-frozen-inference-graph">Export TensorFlow model to frozen inference graph</h3>
<p>Analytics-zoo provides a useful utility function, <code>export_tf</code>, to export a TensorFlow model
to frozen inference graph.</p>
<p>For example:</p>
<p><strong>Python:</strong></p>
<pre><code class="python">import tensorflow as tf
from nets import inception
slim = tf.contrib.slim

images = tf.placeholder(dtype=tf.float32, shape=(None, 224, 224, 3))

with slim.arg_scope(inception.inception_v1_arg_scope()):
    logits, end_points = inception.inception_v1(images, num_classes=1001, is_training=False)

sess = tf.Session()
saver = tf.train.Saver()
saver.restore(sess, &quot;/tmp/models/inception_v1.ckpt&quot;)

from zoo.util.tf import export_tf
export_tf(sess, &quot;/tmp/models/tfnet&quot;, inputs=[images], outputs=[logits])
</code></pre>

<p>In the above code, the <code>export_tf</code> utility function will frozen the TensorFlow graph, strip unused operation according to the inputs and outputs and save it to the specified directory along with the input/output tensor names. </p>
<h3 id="creating-a-tfnet">Creating a TFNet</h3>
<p>After we have export the TensorFlow model, we can easily create a TFNet.</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val m = TFNet(&quot;/tmp/models/tfnet&quot;)
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">m = TFNet.from_export_folder(&quot;/tmp/models/tfnet&quot;)
</code></pre>

<p>Please refer to <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/zoo/src/main/scala/com/intel/analytics/zoo/examples/tfnet">TFNet Object Detection Example (Scala)</a>
or <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/pyzoo/zoo/examples/tensorflow/tfnet">TFNet Object Detection Example (Python)</a> and
the <a href="https://github.com/intel-analytics/analytics-zoo/tree/master/apps/tfnet">Image Classification Using TFNet Notebook</a> for more information.</p>

  <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>